{"success":true,"payload":{"value":{"id":"ef7f1c065577","versionId":"92c2052142e2","creatorId":"a6d788faa5e5","homeCollectionId":"23738d481ce8","title":"Experimenting with Dart and Wasm","detectedLanguage":"en","latestVersion":"92c2052142e2","latestPublishedVersion":"92c2052142e2","hasUnpublishedEdits":false,"latestRev":412,"createdAt":1626955307392,"updatedAt":1641440130027,"acceptedAt":0,"firstPublishedAt":1627410317373,"latestPublishedAt":1627473294965,"vote":false,"experimentalCss":"","displayAuthor":"","content":{"subtitle":"Compiling Dart to Wasm, and calling Wasm modules from Dart","bodyModel":{"paragraphs":[{"name":"e051","type":3,"text":"Experimenting with Dart and Wasm","markups":[]},{"name":"3d0a","type":13,"text":"Compiling Dart to Wasm, and calling Wasm modules from Dart","markups":[]},{"name":"fd70","type":1,"text":"By Liam Appelbe & Michael Thomsen","markups":[{"type":2,"start":0,"end":33}]},{"name":"cdf0","type":1,"text":"WebAssembly (commonly abbreviated to Wasm) is “a binary instruction format for a stack-based virtual machine”. Although Wasm was originally designed for running native code on the web, Wasm has since evolved into a general technology for running compiled code across multiple platforms. Dart is already a highly portable and multi-platform language, so we’re very interested in how Wasm might enable us to extend these qualities of Dart.","markups":[{"type":3,"start":0,"end":11,"href":"https://webassembly.org/","title":"","rel":"","anchorType":0},{"type":2,"start":46,"end":110}]},{"name":"e2ae","type":3,"text":"Why experiment with Wasm?","markups":[]},{"name":"0e97","type":1,"text":"Wasm has gained broad support by browser vendors, such as Chrome, Edge, Firefox, and WebKit. This makes Wasm a very interesting prospect for running binary code in the browser. However, originally Wasm wasn’t designed for programming languages with garbage collection (GC), such as Dart and Java/Kotlin, making it difficult to efficiently compile GC-based languages to Wasm. By engaging with the Wasm project on their recent GC proposal, we’re hoping to both provide technical feedback on the proposal, and learn more about what gains we might get from running Dart-based web apps via Wasm code.","markups":[{"type":3,"start":16,"end":29,"href":"https://webassembly.org/roadmap/","title":"","rel":"","anchorType":0},{"type":3,"start":425,"end":436,"href":"https://github.com/WebAssembly/gc/blob/master/README.md","title":"","rel":"","anchorType":0}]},{"name":"e252","type":1,"text":"A second quality of Wasm is that the binary Wasm modules are platform independent. This potentially makes interoperability with existing code more practical: If that existing code could be compiled to Wasm, then Dart apps across all platforms could depend on a single, shared binary Wasm module.","markups":[]},{"name":"6f01","type":1,"text":"In the remainder of this post we’ll discuss our experiments with Wasm and Dart in two forms:","markups":[]},{"name":"c48e","type":1,"text":"1) Dart to Wasm compilation: Extending our AOT compilers with support for compiling Dart source code to Wasm binary code (issue 32894).","markups":[{"type":3,"start":128,"end":133,"href":"https://github.com/dart-lang/sdk/issues/32894","title":"","rel":"","anchorType":0},{"type":1,"start":3,"end":27}]},{"name":"2987","type":1,"text":"2) Dart to Wasm interop: Support for calling from Dart code to compiled Wasm modules (issues 37355 & 37882).","markups":[{"type":3,"start":93,"end":98,"href":"https://github.com/dart-lang/sdk/issues/37355","title":"","rel":"","anchorType":0},{"type":3,"start":101,"end":106,"href":"https://github.com/dart-lang/sdk/issues/37882","title":"","rel":"","anchorType":0},{"type":1,"start":3,"end":23}]},{"name":"34cc","type":4,"text":"Illustration of the two potential uses of Wasm with Dart","markups":[],"layout":1,"metadata":{"id":"1*UqHnD9vyTvndgJpz8gOv7Q.png","originalWidth":685,"originalHeight":336}},{"name":"e2f6","type":3,"text":"Compiling Dart to Wasm","markups":[]},{"name":"d770","type":1,"text":"As mentioned, Wasm originated as a way of running native code on the web. The web is traditionally powered by JavaScript code, which is run in a virtual machine (VM) that performs just-in-time (JIT) compilation of the JavaScript code to native code while the web app is running. In current Dart frameworks that target the web, such as Flutter web, the Dart app code is compiled to optimized JavaScript for deployment, and this JavaScript is then JIT-compiled by the web platform to native code when the app is running.","markups":[{"type":3,"start":335,"end":346,"href":"https://flutter.dev/web","title":"","rel":"","anchorType":0},{"type":3,"start":381,"end":390,"href":"https://dart.dev/web/deployment","title":"","rel":"","anchorType":0}]},{"name":"df44","type":1,"text":"We’re investigating compilation of Dart code directly to Wasm native code to see if we can get a more direct path to running native code on the web. The Wasm assembly format is low-level and closer than JavaScript to the abstraction level of machine code, which leads to improved startup time and generally a more predictable efficiency.","markups":[]},{"name":"4efa","type":1,"text":"Dart’s support for compiling to Wasm is an early stage investigation and the compiler is incomplete, but we’re experimenting to learn. We’ve always had an interest in Wasm as a compilation target for Dart, but its original form doesn’t work well for languages with garbage collection. Wasm lacks built-in garbage collection support, so languages like Dart must include a garbage collection implementation into the compiled Wasm module. Including a GC implementation would be highly complex, would inflate the size of the compiled Wasm code and hurt startup time, and wouldn’t lend itself well to object-level interop with the rest of the browser system.","markups":[]},{"name":"5ed2","type":1,"text":"Fortunately, an ongoing effort in the WebAssembly community, known as Wasm GC, is exploring the possibility of expanding Wasm with direct and performant support for garbage collected languages. Given our longstanding interest in Wasm, we saw an opportunity to engage the community and provide real-world experience by writing a compiler that translates Dart to Wasm GC.","markups":[{"type":3,"start":70,"end":77,"href":"https://github.com/WebAssembly/gc/blob/master/README.md","title":"","rel":"","anchorType":0}]},{"name":"7d0d","type":1,"text":"It’s too early to predict where this might take us, but our initial prototyping is showing very positive results, with initial benchmarks showing both faster time to first frame and faster average frame time / throughput. If you’re interested in learning more about the project, take a look at the wasm_prototype source code.","markups":[{"type":3,"start":298,"end":312,"href":"https://github.com/askeksa-google/sdk/blob/wasm_prototype/dart2wasm.md","title":"","rel":"","anchorType":0}]},{"name":"f59c","type":3,"text":"Interoperability with Wasm code (package:wasm)","markups":[]},{"name":"36f6","type":1,"text":"Besides compiling to Wasm, we’re also interested in investigating if Wasm can be used for integrating with existing code in a way that is more cross platform. Several languages support compiling to modules that follow the C calling convention, and with Dart FFI you have interoperability with these modules. Dart FFI can be a great way of leveraging existing source code and libraries, rather than having to reimplement the code in Dart.","markups":[{"type":3,"start":253,"end":261,"href":"https://dart.dev/guides/libraries/c-interop","title":"","rel":"","anchorType":0}]},{"name":"fd3d","type":1,"text":"However, because C modules are platform specific, distributing shared packages with native C modules is complicated: it requires either a universal build system, or distributing multiple binary modules (one for each desired platform). Distribution would be much easier if a single Wasm binary assembly format could be used across all platforms. Then, rather than compiling your library to platform-specific binary code for every target platform, you could compile it once to a Wasm binary module and run that everywhere. This would potentially open the door to easy distribution on pub.dev of packages that contain native code.","markups":[{"type":3,"start":582,"end":589,"href":"https://pub.dev","title":"","rel":"","anchorType":0}]},{"name":"363e","type":1,"text":"We’re experimenting with support for Wasm interop in a new package, package:wasm. This prototype is built on the Wasmer runtime, and it supports WASI for OS interaction. Note that our current prototype is incomplete and supports only desktop platforms (Windows, Linux, and macOS).","markups":[{"type":10,"start":68,"end":80},{"type":3,"start":68,"end":80,"href":"https://pub.dev/packages/wasm","title":"","rel":"","anchorType":0},{"type":3,"start":113,"end":119,"href":"https://wasmer.io/","title":"","rel":"","anchorType":0},{"type":3,"start":145,"end":149,"href":"https://wasi.dev/","title":"","rel":"","anchorType":0}]},{"name":"e2df","type":3,"text":"Example: Calling into the Brotli compression library","markups":[]},{"name":"5e49","type":1,"text":"Let’s take a look at an example of using package:wasm to leverage the Brotli compression library, compiled to a Wasm module. In the example, we’ll read an input file, compress it, report its compression ratio, and then decompress it and verify we get the input back. See the GitHub repo for the full sample source code. Because package:wasm is built on top of dart:ffi, you may find the steps familiar if you have experience with FFI.","markups":[{"type":10,"start":41,"end":53},{"type":10,"start":328,"end":340},{"type":10,"start":360,"end":368},{"type":3,"start":70,"end":96,"href":"https://github.com/google/brotli","title":"","rel":"","anchorType":0},{"type":3,"start":300,"end":318,"href":"https://github.com/dart-lang/wasm/tree/main/example","title":"","rel":"","anchorType":0},{"type":3,"start":360,"end":368,"href":"https://dart.dev/guides/libraries/c-interop","title":"","rel":"","anchorType":0}]},{"name":"903e","type":1,"text":"There are a few ways of compiling C code to Wasm, but in this case we used wasienv. Full details are available in the README.","markups":[{"type":3,"start":75,"end":82,"href":"https://github.com/wasienv/wasienv","title":"","rel":"","anchorType":0},{"type":3,"start":118,"end":124,"href":"https://github.com/dart-lang/wasm/blob/main/README.md","title":"","rel":"","anchorType":0}]},{"name":"8b16","type":1,"text":"For this example, we’ll try to call these Brotli functions for compressing and decompressing data:","markups":[]},{"name":"8a18","type":8,"text":"int BrotliEncoderCompress(\n  int quality, int lgwin, int mode, size_t input_size,\n  const uint8_t* input_buffer, size_t* output_size,\n  uint8_t* output_buffer);","markups":[]},{"name":"005d","type":8,"text":"int BrotliDecoderDecompress(\n  size_t encoded_size, const uint8_t* encoded_buffer,\n  size_t* output_size, uint8_t* output_buffer);","markups":[]},{"name":"4332","type":1,"text":"The quality, lgwin, and mode arguments are tuning parameters for the encoder. The details aren’t relevant to the example, so we’ll just use default values for these. Another thing to note is that output_size is an in-out parameter. When we call these functions, output_size must be initialized with the size of the output_buffer that we have allocated, and afterwards it will be set to the amount of the buffer that was actually used.","markups":[{"type":10,"start":4,"end":11},{"type":10,"start":13,"end":18},{"type":10,"start":24,"end":28},{"type":10,"start":196,"end":207},{"type":10,"start":262,"end":273},{"type":10,"start":315,"end":328}]},{"name":"5999","type":1,"text":"The first step is to use our compiled Wasm binary to construct a WasmModule object. The binary data should be a Uint8List, which we can get by reading it from a file using file.readAsBytesSync().","markups":[{"type":10,"start":65,"end":75},{"type":10,"start":112,"end":121},{"type":10,"start":172,"end":194}]},{"name":"1e9d","type":8,"text":"var brotliPath = Platform.script.resolve(‘libbrotli.wasm’);\nvar moduleData = File(brotliPath.path).readAsBytesSync();\nvar module = WasmModule(moduleData);","markups":[]},{"name":"addd","type":1,"text":"A very useful debugging tool for making sure our Wasm module has the API we expect is module.describe(). This returns a string listing all of the module’s imports and exports.","markups":[{"type":10,"start":86,"end":103}]},{"name":"71ee","type":8,"text":"print(module.describe());","markups":[]},{"name":"0338","type":1,"text":"For our Brotli library, this is the output:","markups":[]},{"name":"36a4","type":8,"text":"import function: int32 wasi_unstable::fd_close(int32)\nimport function: int32 wasi_unstable::fd_write(int32, int32, int32, int32)\nimport function: int32 wasi_unstable::fd_fdstat_get(int32, int32)\nimport function: int32 wasi_unstable::fd_seek(int32, int64, int32, int32)\nimport function: void wasi_unstable::proc_exit(int32)","markups":[]},{"name":"8860","type":8,"text":"export memory: memory\nexport function: int32 BrotliDecoderSetParameter(int32, int32, int32)\nexport function: int32 BrotliDecoderCreateInstance(int32, int32, int32)\nexport function: void BrotliDecoderDestroyInstance(int32)\nexport function: int32 BrotliDecoderDecompress(int32, int32, int32, int32)\n…\nexport function: int32 BrotliEncoderSetParameter(int32, int32, int32)\nexport function: int32 BrotliEncoderCreateInstance(int32, int32, int32)\nexport function: void BrotliEncoderDestroyInstance(int32)\nexport function: int32 BrotliEncoderMaxCompressedSize(int32)\nexport function: int32 BrotliEncoderCompress(int32, int32, int32, int32, int32, int32, int32)","markups":[]},{"name":"8af4","type":8,"text":"…","markups":[]},{"name":"bcc0","type":1,"text":"We can see that the module imports some WASI functions, and exports its memory and a bunch of Brotli functions. The two functions we’re interested in are exported, but their signature looks a bit different. This is because Wasm only supports 32-bit and 64-bit ints and floats. The pointers have become int32 indexes into the exported memory.","markups":[{"type":10,"start":302,"end":307}]},{"name":"1649","type":1,"text":"The next step is to instantiate the module. During instantiation we must fill every import that the module is expecting. Instantiation uses the builder pattern (module.instantiate(). initialization… .build()). Our library only imports WASI functions, so we can just call enableWasi():","markups":[{"type":10,"start":160,"end":208},{"type":10,"start":271,"end":283}]},{"name":"f172","type":8,"text":"var instance = module.instantiate().enableWasi().build();","markups":[]},{"name":"32be","type":1,"text":"If we had additional non-WASI function imports we could use addFunction() to import a Dart function into the wasm library.","markups":[{"type":10,"start":60,"end":73}]},{"name":"9541","type":1,"text":"Now that we have a WasmInstance, we can look up any of its exported functions, or inspect its memory:","markups":[{"type":10,"start":19,"end":31}]},{"name":"ad56","type":8,"text":"var memory = instance.memory;\nvar compress = instance.lookupFunction(“BrotliEncoderCompress”);\nvar decompress = instance.lookupFunction(“BrotliDecoderDecompress”);","markups":[]},{"name":"b04b","type":1,"text":"The next thing we want to do is use the compress and decompress functions on our input file. But we can’t pass the data directly to these functions. The C functions take uint8_t pointers to the data, but in Wasm code these pointers become int32 indexes into the instance’s memory. Brotli also reports the size of the compressed and decompressed data using size_t pointers, which also become int32s.","markups":[{"type":10,"start":170,"end":177},{"type":10,"start":239,"end":244},{"type":10,"start":356,"end":362},{"type":10,"start":391,"end":396}]},{"name":"110a","type":1,"text":"So to pass our data to the functions we have to copy it into the instance’s memory and pass its index to the function. We need 5 regions of memory: the input data, the compressed data, the compressed size, the decompressed data, and the decompressed size. For simplicity we’re just going to grab some unused areas of memory, but you could also export malloc() and free() in your library.","markups":[{"type":10,"start":351,"end":359},{"type":10,"start":364,"end":370}]},{"name":"0455","type":1,"text":"To make sure we’re putting the data in unused memory, we’re going to grow the instance memory and use the new region for our data:","markups":[]},{"name":"eea1","type":8,"text":"var inputPtr = memory.lengthInBytes;\nmemory.grow((3 * inputData.length /\n    WasmMemory.kPageSizeInBytes).ceil());\nvar memoryView = memory.view;\nvar outputPtr = inputPtr + inputData.length;\nvar outSizePtr = outputPtr + inputData.length;\nvar decodedPtr = outSizePtr + 4;\nvar decSizePtr = decodedPtr + inputData.length;","markups":[]},{"name":"a5a9","type":1,"text":"Our memory regions look like this:","markups":[]},{"name":"c5ce","type":8,"text":"[initial instance memory][input][output][output size][decoded][decoded size]","markups":[]},{"name":"0190","type":1,"text":"Next, we load the input data in the memory, and call our compression function:","markups":[]},{"name":"1a7a","type":8,"text":"memoryView.setRange(\n    inputPtr, inputPtr + inputData.length, inputData);","markups":[]},{"name":"37dc","type":8,"text":"var status = compress(kDefaultQuality, kDefaultWindow, kDefaultMode,\n    inputData.length, inputPtr, outSizePtr, outputPtr);","markups":[]},{"name":"c94b","type":1,"text":"The rest of the example works similarly. This is the result:","markups":[]},{"name":"d1f5","type":8,"text":"Loading lipsum.txt\nInput size: 3210 bytes","markups":[]},{"name":"ca70","type":8,"text":"Compressing…\nCompression status: 1\nCompressed size: 1198 bytes\nSpace saving: 62.68%","markups":[]},{"name":"8e09","type":8,"text":"Decompressing…\nDecompression status: 1\nDecompressed size: 3210 bytes","markups":[]},{"name":"06c8","type":8,"text":"Verifying decompression…\nDecompression succeeded :)","markups":[]},{"name":"6d1d","type":3,"text":"Trying package:wasm","markups":[]},{"name":"ad43","type":1,"text":"If you’re interested in trying Wasm interop, check out the package:wasm README for instructions.","markups":[{"type":10,"start":59,"end":71},{"type":3,"start":72,"end":78,"href":"https://pub.dev/packages/wasm","title":"","rel":"","anchorType":0}]},{"name":"909c","type":3,"text":"Roadmap","markups":[]},{"name":"d81a","type":1,"text":"Both Wasm compilation and Wasm interop are experiments. If those experiments prove fruitful, we plan to continue to develop them and eventually productize them into stable, supported versions. However, if we learn that something doesn’t work as intended, or see a lack of interest, we’ll discontinue the experiments.","markups":[]},{"name":"7421","type":1,"text":"We’re making these experiments to learn, with two main components. First, we want to learn about the feasibility of technically supporting Wasm, and what the characteristics of this support might be. Can it make Dart code faster, smaller, or more predictable? Second, we’re interested in exploring what new technical capabilities Wasm might unlock, and what new use cases these might enable for Dart developers. Can we make interop with native code more portable?","markups":[]},{"name":"146a","type":1,"text":"How do you think Wasm might apply to your needs? What do you think you’d use it for? We’d love to hear your thoughts. Please let us know on the Dart misc discussion group.","markups":[{"type":3,"start":144,"end":170,"href":"https://groups.google.com/a/dartlang.org/g/misc/","title":"","rel":"","anchorType":0}]}],"sections":[{"name":"b17b","startIndex":0}]},"postDisplay":{"coverless":true}},"virtuals":{"statusForCollection":"APPROVED","allowNotes":true,"previewImage":{"imageId":"1*UqHnD9vyTvndgJpz8gOv7Q.png","filter":"","backgroundSize":"","originalWidth":685,"originalHeight":336,"strategy":"resample","height":0,"width":0},"wordCount":1884,"imageCount":1,"readingTime":7.309433962264151,"subtitle":"Compiling Dart to Wasm, and calling Wasm modules from Dart","userPostRelation":{"userId":"8b6a7f6f197d","postId":"ef7f1c065577","readAt":1649921413940,"readLaterAddedAt":0,"votedAt":0,"collaboratorAddedAt":0,"notesAddedAt":0,"subscribedAt":0,"lastReadSectionName":"b17b","lastReadVersionId":"92c2052142e2","lastReadAt":1639779042802,"lastReadParagraphName":"8e09","lastReadPercentage":0,"viewedAt":1649921364316,"presentedCountInResponseManagement":0,"clapCount":0,"seriesUpdateNotifsOptedInAt":0,"queuedAt":0,"seriesFirstViewedAt":0,"presentedCountInStream":9,"seriesLastViewedAt":0,"audioProgressSec":0},"publishedInCount":1,"usersBySocialRecommends":[],"noIndex":false,"recommends":164,"isBookmarked":false,"tags":[{"slug":"dart","name":"Dart","postCount":13858,"metadata":{"postCount":13858,"coverImage":{"id":"1*rQugDrmwFFsEDL_CqSBJNw.png","originalWidth":1536,"originalHeight":1024,"isFeatured":true}},"type":"Tag"},{"slug":"wasm","name":"Wasm","postCount":907,"metadata":{"postCount":907,"coverImage":{"id":"0*cVcvsQYL9CLwtZqh","originalWidth":576,"originalHeight":384}},"type":"Tag"},{"slug":"computer-science","name":"Computer Science","postCount":42805,"metadata":{"postCount":42805,"coverImage":{"id":"0*EW2TE8xIbMEIqUmS.png","originalWidth":1280,"originalHeight":805,"isFeatured":true}},"type":"Tag"},{"slug":"interoperability","name":"Interoperability","postCount":3824,"metadata":{"postCount":3824,"coverImage":{"id":"1*xd4vZ8rN8u3o83UDFMDMiQ.jpeg","originalWidth":1200,"originalHeight":832,"isFeatured":true,"alt":"A 1790 illustration entitled ‘The World Turned Upside-Down.’ It features a topsy-turvy nature scene in which a giant fish stands on the bank, fishing for a human who is gasping in the water. The sky is filled with flying fishes and eels, the sea is filled with swimming birds. The image has been hand-tinted. The background has been replaced with a printed circuit board."}},"type":"Tag"},{"slug":"webassembly","name":"Webassembly","postCount":2000,"metadata":{"postCount":2000,"coverImage":{"id":"0*3h3Q27A7faOuOpSV","originalWidth":576,"originalHeight":384,"isFeatured":true}},"type":"Tag"}],"socialRecommendsCount":0,"responsesCreatedCount":1,"links":{"entries":[{"url":"https://dart.dev/web/deployment","alts":[],"httpStatus":200},{"url":"https://dart.dev/guides/libraries/c-interop","alts":[],"httpStatus":200},{"url":"https://pub.dev/packages/wasm","alts":[],"httpStatus":200},{"url":"https://pub.dev","alts":[],"httpStatus":200},{"url":"https://flutter.dev/web","alts":[],"httpStatus":200},{"url":"https://webassembly.org/roadmap/","alts":[],"httpStatus":200},{"url":"https://webassembly.org/","alts":[],"httpStatus":200},{"url":"https://wasi.dev/","alts":[],"httpStatus":200},{"url":"https://github.com/dart-lang/wasm/tree/main/example","alts":[],"httpStatus":200},{"url":"https://github.com/askeksa-google/sdk/blob/wasm_prototype/dart2wasm.md","alts":[],"httpStatus":200},{"url":"https://github.com/google/brotli","alts":[],"httpStatus":200},{"url":"https://github.com/dart-lang/wasm/blob/main/README.md","alts":[],"httpStatus":200},{"url":"https://github.com/wasienv/wasienv","alts":[],"httpStatus":200},{"url":"https://github.com/WebAssembly/gc/blob/master/README.md","alts":[],"httpStatus":200},{"url":"https://groups.google.com/a/dartlang.org/g/misc/","alts":[],"httpStatus":200},{"url":"https://wasmer.io/","alts":[],"httpStatus":200},{"url":"https://github.com/dart-lang/sdk/issues/37355","alts":[],"httpStatus":200},{"url":"https://github.com/dart-lang/sdk/issues/32894","alts":[],"httpStatus":200},{"url":"https://github.com/dart-lang/sdk/issues/37882","alts":[],"httpStatus":200}],"version":"0.3","generatedAt":1627473296707},"isLockedPreviewOnly":false,"metaDescription":"","totalClapCount":1100,"sectionCount":1,"readingList":0,"topics":[{"topicId":"decb52b64abf","slug":"programming","createdAt":1493934116328,"deletedAt":0,"image":{"id":"1*iPa136b1cGEO7lvoXg6uHQ@2x.jpeg","originalWidth":6016,"originalHeight":4016},"name":"Programming","description":"The good, the bad, the buggy.","relatedTopics":[],"visibility":1,"relatedTags":[],"relatedTopicIds":[],"seoTitle":"Programming News and Articles — Medium","type":"Topic"}]},"coverless":true,"slug":"experimenting-with-dart-and-wasm","translationSourcePostId":"","translationSourceCreatorId":"","isApprovedTranslation":false,"inResponseToPostId":"","inResponseToRemovedAt":0,"isTitleSynthesized":true,"allowResponses":true,"importedUrl":"","importedPublishedAt":0,"visibility":0,"uniqueSlug":"experimenting-with-dart-and-wasm-ef7f1c065577","previewContent":{"bodyModel":{"paragraphs":[{"name":"e051","type":3,"text":"Experimenting with Dart and Wasm","markups":[],"alignment":1},{"name":"3d0a","type":13,"text":"Compiling Dart to Wasm, and calling Wasm modules from Dart","markups":[],"alignment":1},{"name":"fd70","type":1,"text":"By Liam Appelbe & Michael Thomsen","markups":[{"type":2,"start":0,"end":33}],"alignment":1},{"name":"cdf0","type":1,"text":"WebAssembly (commonly abbreviated to Wasm) is “a binary instruction format for a…","markups":[{"type":3,"start":0,"end":11,"href":"https://webassembly.org/","title":"","rel":"","anchorType":0},{"type":2,"start":46,"end":80}],"alignment":1}],"sections":[{"startIndex":0}]},"isFullContent":false,"subtitle":"Compiling Dart to Wasm, and calling Wasm modules from Dart"},"license":0,"inResponseToMediaResourceId":"","canonicalUrl":"https://blog.dart.dev/experimenting-with-dart-and-wasm-ef7f1c065577","approvedHomeCollectionId":"23738d481ce8","isNewsletter":false,"newsletterId":"","webCanonicalUrl":"https://blog.dart.dev/experimenting-with-dart-and-wasm-ef7f1c065577","mediumUrl":"https://blog.dart.dev/experimenting-with-dart-and-wasm-ef7f1c065577","migrationId":"","notifyFollowers":true,"notifyTwitter":false,"notifyFacebook":false,"responseHiddenOnParentPostAt":0,"isSeries":false,"isSubscriptionLocked":false,"seriesLastAppendedAt":0,"audioVersionDurationSec":0,"sequenceId":"","isEligibleForRevenue":false,"isBlockedFromHightower":false,"deletedAt":0,"lockedPostSource":0,"hightowerMinimumGuaranteeStartsAt":0,"hightowerMinimumGuaranteeEndsAt":0,"featureLockRequestAcceptedAt":0,"mongerRequestType":1,"layerCake":3,"socialTitle":"","socialDek":"","editorialPreviewTitle":"","editorialPreviewDek":"","curationEligibleAt":0,"primaryTopic":{"topicId":"decb52b64abf","slug":"programming","createdAt":1493934116328,"deletedAt":0,"image":{"id":"1*iPa136b1cGEO7lvoXg6uHQ@2x.jpeg","originalWidth":6016,"originalHeight":4016},"name":"Programming","description":"The good, the bad, the buggy.","relatedTopics":[],"visibility":1,"relatedTags":[],"relatedTopicIds":[],"seoTitle":"Programming News and Articles — Medium","type":"Topic"},"primaryTopicId":"decb52b64abf","isProxyPost":false,"proxyPostFaviconUrl":"","proxyPostProviderName":"","proxyPostType":0,"isSuspended":false,"isLimitedState":false,"seoTitle":"Experimenting with compiling Dart to Wasm, and calling Wasm from Dart | by the Dart team","previewContent2":{"bodyModel":{"paragraphs":[{"name":"e051","type":3,"text":"Experimenting with Dart and Wasm","markups":[]},{"name":"3d0a","type":13,"text":"Compiling Dart to Wasm, and calling Wasm modules from Dart","markups":[]},{"name":"fd70","type":1,"text":"By Liam Appelbe & Michael Thomsen","markups":[{"type":2,"start":0,"end":33}]},{"name":"cdf0","type":1,"text":"WebAssembly (commonly abbreviated to Wasm) is “a binary instruction format for a stack-based virtual machine”. Although Wasm was originally designed for running native code on the web, Wasm has since evolved into a general technology for running compiled code across multiple platforms. Dart is…","markups":[{"type":3,"start":0,"end":11,"href":"https://webassembly.org/","title":"","rel":"","anchorType":0},{"type":2,"start":46,"end":110}]}],"sections":[{"name":"b17b","startIndex":0}]},"isFullContent":false,"subtitle":"Compiling Dart to Wasm, and calling Wasm modules from Dart"},"cardType":0,"isDistributionAlertDismissed":false,"isShortform":false,"shortformType":0,"responsesLocked":false,"isLockedResponse":false,"isPublishToEmail":false,"responseDistribution":0,"isMarkedPaywallOnly":false,"type":"Post"},"mentionedUsers":[],"collaborators":[],"hideMeter":false,"shareKey":"f5aa19249a34bdfbc60c3954a3e3cbbe","collectionUserRelations":[{"collectionId":"23738d481ce8","userId":"8b6a7f6f197d","role":"ADMIN"},{"collectionId":"4da7dfd21a33","userId":"8b6a7f6f197d","role":"WRITER"},{"collectionId":"24d8f4fa8912","userId":"8b6a7f6f197d","role":"WRITER"}],"mode":"canEdit","references":{"User":{"a6d788faa5e5":{"userId":"a6d788faa5e5","name":"Michael Thomsen","username":"mit.mit","createdAt":1481367237471,"imageId":"0*Y_CFLc1qadgr3tPK.","backgroundImageId":"","bio":"Product Manager working on Dart and Flutter. Helping developers is my passion!","twitterScreenName":"","socialStats":{"userId":"a6d788faa5e5","usersFollowedCount":1,"usersFollowedByCount":9653,"type":"SocialStats"},"social":{"userId":"8b6a7f6f197d","targetUserId":"a6d788faa5e5","isFollowing":true,"isTwitterFollowing":false,"isFacebookFollowing":false,"isMediumFollowing":true,"type":"Social"},"allowNotes":1,"mediumMemberAt":1752847030513,"isWriterProgramEnrolled":true,"isSuspended":false,"isMembershipTrialEligible":true,"facebookDisplayName":"","optInToIceland":true,"hasCompletedProfile":false,"userDismissableFlags":[1,2,5,8,12,17,18,21,30,32,33,53,58,59,61],"hasSeenIcelandOnboarding":true,"postSubscribeMembershipUpsellShownAt":0,"languageCode":"da","type":"User"}},"Collection":{"23738d481ce8":{"id":"23738d481ce8","name":"Dart","slug":"dartlang","tags":["MOBILE APP DEVELOPMENT","WEB DEVELOPMENT","DART","PROGRAMMING LANGUAGES","SOFTWARE DEVELOPMENT"],"creatorId":"a6d788faa5e5","description":"Dart is an approachable, portable, and productive language for high-quality apps on any platform. Learn more at https://dart.dev.","shortDescription":"Dart is an approachable, portable, and productive language…","image":{"imageId":"1*uWy1Ajpd0oTUQBO9WBHoQg@2x.png","filter":"","backgroundSize":"","originalWidth":1001,"originalHeight":1001,"strategy":"resample","height":0,"width":0},"metadata":{"followerCount":14031,"activeAt":1762974121956},"virtuals":{"permissions":{"canPublish":true,"canPublishAll":true,"canRepublish":true,"canRemove":true,"canManageAll":true,"canSubmit":true,"canEditPosts":true,"canAddWriters":true,"canViewStats":true,"canSendNewsletter":true,"canViewLockedPosts":true,"canViewCloaked":true,"canEditOwnPosts":true,"canBeAssignedAuthor":true,"canEnrollInHightower":false,"canLockPostsForMediumMembers":false,"canLockOwnPostsForMediumMembers":false,"canViewNewsletterV2Stats":true,"canCreateNewsletterV3":true},"isSubscribed":true,"isEnrolledInHightower":false,"isEligibleForHightower":false,"isSubscribedToCollectionEmails":false,"isMuted":false,"canToggleEmail":false,"isWriter":false},"logo":{"imageId":"1*NRb7RFVWJQFzY47j3v4U7Q.png","filter":"","backgroundSize":"","originalWidth":400,"originalHeight":154,"strategy":"resample","height":0,"width":0},"twitterUsername":"dart_lang","publicEmail":"medium@dartlang.org","domain":"blog.dart.dev","sections":[{"type":2,"collectionHeaderMetadata":{"title":"Dart","description":"An approachable, portable, and productive language for high-quality apps on any platform","backgroundImage":{},"logoImage":{"id":"1*knHF_qpxdtS8h0Z8EeqowA@2x.png","originalWidth":1080,"originalHeight":1080,"alt":"Dart"},"alignment":2,"layout":5}},{"type":1,"postListMetadata":{"source":1,"layout":4,"number":7,"postIds":[]}},{"type":1,"postListMetadata":{"source":1,"layout":5,"number":15,"postIds":[]}}],"tintColor":"#FF042B59","lightText":true,"favicon":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"colorPalette":{"defaultBackgroundSpectrum":{"colorPoints":[{"color":"#FF6588BA","point":0},{"color":"#FF607EAB","point":0.1},{"color":"#FF59759C","point":0.2},{"color":"#FF536B8E","point":0.3},{"color":"#FF4C617F","point":0.4},{"color":"#FF445670","point":0.5},{"color":"#FF3D4B61","point":0.6},{"color":"#FF344052","point":0.7},{"color":"#FF2B3442","point":0.8},{"color":"#FF212832","point":0.9},{"color":"#FF161A22","point":1}],"backgroundColor":"#FFFFFFFF"},"tintBackgroundSpectrum":{"colorPoints":[{"color":"#FF042B59","point":0},{"color":"#FF294871","point":0.1},{"color":"#FF456087","point":0.2},{"color":"#FF5F779B","point":0.3},{"color":"#FF788DAD","point":0.4},{"color":"#FF8FA2BF","point":0.5},{"color":"#FFA5B6CF","point":0.6},{"color":"#FFBBC9DF","point":0.7},{"color":"#FFD1DCEE","point":0.8},{"color":"#FFE6EEFC","point":0.9},{"color":"#FFFBFFFF","point":1}],"backgroundColor":"#FF042B59"},"highlightSpectrum":{"colorPoints":[{"color":"#FFECF3FF","point":0},{"color":"#FFE9F2FF","point":0.1},{"color":"#FFE5F0FF","point":0.2},{"color":"#FFE2EFFF","point":0.3},{"color":"#FFDEEDFF","point":0.4},{"color":"#FFDBEBFF","point":0.5},{"color":"#FFD7EAFF","point":0.6},{"color":"#FFD3E8FF","point":0.7},{"color":"#FFCFE6FF","point":0.8},{"color":"#FFCBE5FF","point":0.9},{"color":"#FFC8E3FF","point":1}],"backgroundColor":"#FFFFFFFF"},"darkBackgroundSpectrum":{"colorPoints":[{"color":"#FF7DA0D3","point":0},{"color":"#FF89A9D8","point":0.1},{"color":"#FF94B1DC","point":0.2},{"color":"#FFA0B9E0","point":0.3},{"color":"#FFABC1E3","point":0.4},{"color":"#FFB6C9E7","point":0.5},{"color":"#FFC0D1EB","point":0.6},{"color":"#FFCBD8EF","point":0.7},{"color":"#FFD5E0F2","point":0.8},{"color":"#FFE0E7F6","point":0.9},{"color":"#FFEAEFFA","point":1}],"backgroundColor":"#FF000000"}},"navItems":[{"type":1,"title":"Announcements","tagSlug":"announcements","url":"https://blog.dart.dev/tagged/announcements","source":"tagSlug"},{"type":5,"title":"Archive","url":"https://blog.dart.dev/archive"},{"type":3,"title":"dart.dev","url":"https://dart.dev"}],"colorBehavior":2,"collectionFeatures":[25],"ampLogo":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"header":{"title":"Dart","description":"An approachable, portable, and productive language for high-quality apps on any platform","backgroundImage":{},"logoImage":{"id":"1*knHF_qpxdtS8h0Z8EeqowA@2x.png","originalWidth":1080,"originalHeight":1080,"alt":"Dart"},"alignment":2,"layout":5},"subscriberCount":14031,"tagline":"Dart is a client-optimized language for fast apps on any platform.","isOptedIntoAurora":false,"isCurationAllowedByDefault":false,"polarisCoverImage":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"ptsQualifiedAt":1616092887098,"type":"Collection"}},"Social":{"a6d788faa5e5":{"userId":"8b6a7f6f197d","targetUserId":"a6d788faa5e5","isFollowing":true,"isTwitterFollowing":false,"isFacebookFollowing":false,"isMediumFollowing":true,"type":"Social"}},"SocialStats":{"a6d788faa5e5":{"userId":"a6d788faa5e5","usersFollowedCount":1,"usersFollowedByCount":9653,"type":"SocialStats"}}}},"v":3,"b":"20260130-1012-root"}
{"success":true,"payload":{"value":{"id":"3e94a0ec06ae","versionId":"9d5a2f1129e3","creatorId":"d4e32e866239","homeCollectionId":"23738d481ce8","title":"Dart DevTools: Analyzing application performance with the CPU Profiler","detectedLanguage":"en","latestVersion":"9d5a2f1129e3","latestPublishedVersion":"9d5a2f1129e3","hasUnpublishedEdits":false,"latestRev":2305,"createdAt":1686596045545,"updatedAt":1686667448831,"acceptedAt":0,"firstPublishedAt":1686605923549,"latestPublishedAt":1686667448831,"vote":false,"experimentalCss":"","displayAuthor":"","content":{"bodyModel":{"paragraphs":[{"name":"5f04","type":3,"text":"Dart DevTools: Analyzing application performance with the CPU Profiler","markups":[]},{"name":"8e25","type":1,"text":"Whether you‚Äôre a backend developer writing a command line tool using Dart, or a UX engineer building applications with Flutter, program performance is critical to the success of your project. Command line tools should minimize latency and apps should be responsive and snappy with no dropped frames. As developers, we try our best to write performant code but sometimes it‚Äôs not clear why our code isn‚Äôt performing as well as we would expect.","markups":[]},{"name":"7d75","type":1,"text":"Tracking down performance issues in a code base can be a daunting task. There are multiple ways to write Flutter code such that it runs slower than it should. Some are glaringly obvious and others nefariously subtle. For example, perhaps you used the wrong API or data structure for a particular situation.","markups":[]},{"name":"bb00","type":1,"text":"This article works through a simple case study examining the performance of a slow Dart command-line interface (CLI) application. You‚Äôll learn about:","markups":[]},{"name":"8748","type":9,"text":"General CPU profilers and their importance.","markups":[]},{"name":"a610","type":9,"text":"The sampling CPU profiler that ships with Dart and Flutter.","markups":[]},{"name":"62e5","type":1,"text":"With this new understanding of CPU profiling, we‚Äôll debug the performance of our program. We‚Äôll do so using the Dart DevTools CPU Profiler and dart:developer‚Äôs UserTag functionality to pinpoint the inefficient code. We‚Äôve got lots to cover, so let‚Äôs get started!","markups":[{"type":10,"start":143,"end":157},{"type":10,"start":160,"end":167}]},{"name":"4a94","type":1,"text":"Note: Dart DevTools is also referred to as Flutter DevTools, but shouldn‚Äôt be confused with Chrome DevTools.","markups":[{"type":2,"start":0,"end":108}]},{"name":"8c80","type":3,"text":"Case Study: Implementing grep in Dart","markups":[]},{"name":"c567","type":1,"text":"Consider the following simple Dart CLI application:","markups":[]},{"name":"2588","type":8,"text":"\n// filename: grep.dart\nimport 'dart:io';\n\n/// Finds and prints all instances of [pattern] in the [file].\nvoid grep(File file, String pattern) {\n  // Open the file and read its contents.\n  final lines = file.readAsLinesSync();\n\n  String output = '';\n  int lineNum = 1;\n  // Check each line to see if it matches `pattern`.\n  for (final line in lines) {\n    final matcher = RegExp(pattern);\n    if (matcher.hasMatch(line)) {\n      final foundMessage = '$lineNum:$line';\n      output += foundMessage;\n    }\n    lineNum++;\n  }\n  stdout.writeln(output);\n}\n\nvoid main(List<String> arguments) { \n  if (arguments.length != 2) {\n    print('Usage: dart grep.dart <path> <pattern>');\n    exitCode = 64;\n    return;\n  }\n  final path = arguments[0];\n  final pattern = arguments[1];\n\n  final file = File(path);\n  if (!file.existsSync()) {\n    stderr.writeln(\"Error: unable to open file '$path'\");\n    exitCode = 64;\n    return;\n  }\n\n  grep(file, pattern);\n}","markups":[],"codeBlockMetadata":{"mode":2,"lang":"dart"}},{"name":"60fa","type":1,"text":"The grep.dart program implements a version of the common Unix tool. It allows users to search files for the occurrence of a string of characters that matches a specified pattern. For example, given a file names.txt containing:","markups":[{"type":10,"start":4,"end":13},{"type":10,"start":205,"end":214}]},{"name":"d89b","type":8,"text":"$ cat names.txt\nFrank\nBob\nFranny\nJune\nBen\nFrancis","markups":[],"codeBlockMetadata":{"mode":1,"lang":"shell"}},{"name":"e05b","type":1,"text":"Let‚Äôs find all lines containing the string 'Fran':","markups":[{"type":10,"start":43,"end":49}]},{"name":"e551","type":8,"text":"$ dart grep.dart names.txt 'Fran'\n1:Frank\n3:Franny\n6:Francis","markups":[],"codeBlockMetadata":{"mode":2,"lang":"shell"}},{"name":"789f","type":1,"text":"Excellent! We should expect this output from grep. That said, names.txt is a small file. Let‚Äôs try and find all the instances of 'Hummingbird' in a larger text document. What if we ran the same program on a 437,000 line, 147 MiB file about hummingbirds?","markups":[{"type":10,"start":45,"end":49},{"type":10,"start":62,"end":71},{"type":10,"start":129,"end":142},{"type":2,"start":77,"end":82}]},{"name":"dc63","type":8,"text":"$ dart grep.dart hummingbird_encyclopedia.txt 'Hummingbird'","markups":[],"codeBlockMetadata":{"mode":2,"lang":"shell"}},{"name":"11a6","type":1,"text":"Huh‚Ä¶ it doesn‚Äôt complete, even after two minutes. How does Unix grep perform?","markups":[{"type":10,"start":64,"end":68},{"type":1,"start":37,"end":48}]},{"name":"171c","type":8,"text":"$ grep -n 'Hummingbird' hummingbird_encyclopedia.txt\n16:'''Hummingbirds''' are [[bird]]s native to the‚Ä¶\n22:Hummingbirds have the highest‚Ä¶\n24:Hummingbirds split from their [[Sister taxon|sister group]]‚Ä¶\n// Output continues","markups":[],"codeBlockMetadata":{"mode":2,"lang":"shell"}},{"name":"3bf2","type":1,"text":"Unix‚Äôs grep searched the entire file and returned all lines containing Hummingbird in about 45 seconds. Clearly there‚Äôs something strange in our code that we should investigate. But how can we identify the cause of our performance issues? The CPU Profiler shipped with Dart DevTools is a great place to start!","markups":[{"type":10,"start":7,"end":11},{"type":10,"start":71,"end":82},{"type":1,"start":243,"end":255}]},{"name":"9a21","type":3,"text":"What is a CPU profiler?","markups":[]},{"name":"fcd2","type":1,"text":"CPU profiling tools track where a program spends its time when executing. To provide the most computationally efficient CPU profiling experience, the Dart virtual machine (VM), powering Dart CLI and Flutter applications, uses a sampling CPU profiler. When used with tools like Dart DevTools, you can identify performance bottlenecks in Dart programs.","markups":[{"type":1,"start":228,"end":236}]},{"name":"6698","type":1,"text":"A sampling CPU profiler takes a statistical approach to collecting application performance data. It collects samples by interrupting threads at regular intervals and taking a snapshot of the current call stack and other relevant execution state. These samples can be processed to gain insights into approximately how much time is spent executing specific functions, and how frequently functions appear on different call stacks.","markups":[]},{"name":"d8f9","type":1,"text":"The frequency that samples are collected is known as the sampling rate and is measured in samples per second (otherwise known as hertz or Hz). Most sampling profilers have sampling rates of 1000 Hz or higher. Higher sampling rates result in more detailed CPU profiles, at the expense of higher sampling overhead in the target process. At reasonable sampling rates, sampling CPU profilers are efficient and have little to no impact on the performance characteristics of the profiled application. As an added bonus, the collected data is typically less computationally expensive to process for analysis when compared to tracing profilers.","markups":[{"type":1,"start":57,"end":70}]},{"name":"7ec2","type":3,"text":"Deep Dive: How does a sampling profiler work?","markups":[]},{"name":"8c1c","type":1,"text":"This section goes into detail about how the Dart VM‚Äôs sampling CPU profiler works. You don‚Äôt need to know these details when analyzing CPU profiles. If you don‚Äôt care about the nitty gritty details of sampling CPU profilers, skip this section.","markups":[{"type":2,"start":0,"end":243}]},{"name":"fdc4","type":1,"text":"The Dart VM‚Äôs sampling CPU profiler has three important components: the thread interrupter, the sample collector, and the sample processor.","markups":[]},{"name":"e834","type":13,"text":"Thread Interrupter","markups":[]},{"name":"9335","type":1,"text":"The thread interrupter runs on a dedicated thread and triggers the CPU sample collection on each thread that the VM manages. The thread interrupter is typically inactive, only waking up once per sampling interval. After each sampling interval, the interrupter iterates over the list of threads, informing each thread that it should pause and collect a sample. The thread interrupter has slightly different behavior on different platforms due to operating system specific details.","markups":[{"type":3,"start":4,"end":22,"href":"https://github.com/dart-lang/sdk/blob/main/runtime/vm/thread_interrupter.cc","title":"","rel":"","anchorType":0},{"type":1,"start":4,"end":22}]},{"name":"df28","type":1,"text":"On most platforms which support signal-based control flow (Android and Linux), the SIGPROF signal is sent to each thread. This triggers an interrupt that invokes a signal handler registered by the CPU profiler on the target thread that then collects the CPU sample before resuming its work.","markups":[{"type":10,"start":83,"end":90},{"type":3,"start":32,"end":57,"href":"https://en.wikipedia.org/wiki/Signal_(IPC)","title":"","rel":"","anchorType":0},{"type":3,"start":83,"end":90,"href":"https://www.gnu.org/software/libc/manual/html_node/Alarm-Signals.html","title":"","rel":"","anchorType":0},{"type":3,"start":139,"end":148,"href":"https://en.wikipedia.org/wiki/Interrupt","title":"","rel":"","anchorType":0}]},{"name":"90e9","type":1,"text":"On other platforms which don‚Äôt support signals (Windows and Fuchsia) or have poor performance in some situations when using SIGPROF (MacOS and iOS), the thread interrupter uses system calls to explicitly pause and resume each thread after collecting the CPU sample. In this case, sample collection is done on the thread interrupter thread rather than on the thread being sampled.","markups":[]},{"name":"4a99","type":13,"text":"Sample collection","markups":[]},{"name":"97cf","type":1,"text":"Once a thread has been interrupted, the CPU profiler collects a sample of the thread‚Äôs current execution state. Each sample includes metadata such as:","markups":[{"type":3,"start":53,"end":70,"href":"https://github.com/dart-lang/sdk/blob/bbacf39e9c1085650b5f2a180285792ad0dd76d9/runtime/vm/profiler.cc#L1311","title":"","rel":"","anchorType":0},{"type":3,"start":117,"end":123,"href":"https://github.com/dart-lang/sdk/blob/bbacf39e9c1085650b5f2a180285792ad0dd76d9/runtime/vm/profiler.h#L195","title":"","rel":"","anchorType":0}]},{"name":"1ed0","type":9,"text":"thread and isolate identifiers","markups":[]},{"name":"ce7b","type":9,"text":"active user tag for the thread","markups":[{"type":3,"start":7,"end":15,"href":"https://api.dart.dev/stable/dart-developer/UserTag/UserTag.html","title":"","rel":"","anchorType":0}]},{"name":"6a5a","type":9,"text":"collection timestamps","markups":[]},{"name":"3657","type":9,"text":"current stack trace of the sampled thread","markups":[]},{"name":"bd53","type":1,"text":"The collected stack trace consists of a list of program counters (PCs), which correspond to the return addresses of each Dart and native function found on the stack. These PCs are collected through a process known as ‚Äúwalking the stack‚Äù. While performing a stack walk, the stack walker uses the top frame‚Äôs frame pointer (FP) and the known layout of each stack frame to find and record the PC associated with the function as well as the FP of the previous stack frame. The stack walker repeats this process, using the previous frame‚Äôs FP as a starting point, until it reaches the end of the stack as shown in Figure 1.","markups":[{"type":3,"start":257,"end":267,"href":"https://github.com/dart-lang/sdk/blob/bbacf39e9c1085650b5f2a180285792ad0dd76d9/runtime/vm/profiler.cc#L208","title":"","rel":"","anchorType":0}]},{"name":"ec45","type":4,"text":"Figure 1: An example of stack trace collection on an ARM64 system. The stack walker starts at FP(N+1), retrieves the program counter (PC) from address FP(N+1) + 0x10, and adds it to the stack trace as Frame 0. The stack walker then looks up FP(N) from address FP(N+1) + 0x8, repeating the same procedure using FP(N) to look up details for Frame 1.","markups":[{"type":10,"start":94,"end":101},{"type":1,"start":0,"end":347},{"type":2,"start":0,"end":347}],"layout":1,"metadata":{"id":"1*manGRq62JBgJER8ufYlAfA.png","originalWidth":1402,"originalHeight":968}},{"name":"1825","type":1,"text":"Each collected sample is stored in the VM‚Äôs sample buffer, a circular buffer that can store a limited number of CPU samples. This allows for the VM to avoid the need for additional allocations at runtime, which can negatively impact performance or cause bad things to happen if done in the signal handler.","markups":[{"type":3,"start":61,"end":76,"href":"https://en.wikipedia.org/wiki/Circular_buffer","title":"","rel":"","anchorType":0},{"type":3,"start":248,"end":304,"href":"https://en.wikipedia.org/wiki/Signal_(IPC)#Risks","title":"","rel":"","anchorType":0}]},{"name":"279b","type":1,"text":"The size of the sample buffer is fixed at runtime and, once full, old samples will be overwritten with new samples by the profiler. The rate at which the sample buffer fills up depends on the sampling rate and average stack depth of each sample. For example, higher sampling rates and deeper stacks cause the buffer to wrap around more quickly. In DevTools, developers can control how quickly the sample buffer wraps around by choosing between low (1000 Hz), medium (4000 Hz), and high (20,000 Hz) sampling rates.","markups":[{"type":3,"start":427,"end":435,"href":"https://docs.flutter.dev/tools/devtools/cpu-profiler#cpu-sampling-rate","title":"","rel":"","anchorType":0}]},{"name":"deea","type":13,"text":"Sample processing","markups":[]},{"name":"bb81","type":1,"text":"When a client sends a request for a CPU sample profile via the VM service protocol, the CPU profiler needs to process the collected samples before sending them to the client. The profiler:","markups":[{"type":3,"start":63,"end":82,"href":"https://github.com/dart-lang/sdk/blob/main/runtime/vm/service/service.md#getcpusamples","title":"","rel":"","anchorType":0}]},{"name":"157d","type":10,"text":"Iterates over the sample buffer, using filters to only retrieve samples for the isolate and time period specified by the client.","markups":[]},{"name":"71bc","type":10,"text":"Symbolizes, or maps PCs to function names, each stack frame in the set of samples.","markups":[{"type":2,"start":0,"end":10}]},{"name":"27a7","type":10,"text":"Serializes the entire processed sample buffer to JSON.","markups":[]},{"name":"ad35","type":10,"text":"Sends the JSON back to the client.","markups":[]},{"name":"bfd4","type":1,"text":"Even after processing done by the profiler, the CPU samples response is low-level and requires additional processing by developer tooling to be useful. For example, Dart DevTools can convert the list of CPU samples into various structural representations that allow for identifying expensive functions (Bottom Up) and costly call paths (Call Tree and CPU Flame Chart), and inspecting caller and callee statistics (Method Table) for individual methods.","markups":[{"type":3,"start":48,"end":68,"href":"https://github.com/dart-lang/sdk/blob/main/runtime/vm/service/service.md#cpusamples","title":"","rel":"","anchorType":0},{"type":3,"start":303,"end":312,"href":"https://docs.flutter.dev/tools/devtools/cpu-profiler#bottom-up","title":"","rel":"","anchorType":0},{"type":3,"start":337,"end":346,"href":"https://docs.flutter.dev/tools/devtools/cpu-profiler#call-tree","title":"","rel":"","anchorType":0},{"type":3,"start":351,"end":366,"href":"https://docs.flutter.dev/tools/devtools/cpu-profiler#flame-chart","title":"","rel":"","anchorType":0},{"type":3,"start":414,"end":426,"href":"https://docs.flutter.dev/tools/devtools/cpu-profiler#method-table","title":"","rel":"","anchorType":0}]},{"name":"1c81","type":3,"text":"Using Dart DevTools to Profile Dart and Flutter Applications","markups":[]},{"name":"80e6","type":1,"text":"Now that you‚Äôre familiar with what sampling CPU profilers are and how they work, let‚Äôs debug the performance of our grep implementation. Let‚Äôs run the code again with --observe and open up the Dart DevTools CPU Profiler tab:","markups":[{"type":10,"start":116,"end":120},{"type":10,"start":167,"end":176}]},{"name":"01ad","type":1,"text":"Note: You don‚Äôt need to use the --observe flag when testing a Flutter app in DevTools.","markups":[{"type":10,"start":32,"end":42},{"type":1,"start":0,"end":5},{"type":2,"start":0,"end":86}]},{"name":"df4c","type":8,"text":"$ dart ‚Äî observe grep.dart hummingbird_encyclopedia.txt 'Hummingbird'\nThe Dart VM service is listening on http://127.0.0.1:8181/omxEtsCtW9k=/\nThe Dart DevTools debugger and profiler is available at: http://127.0.0.1:8181/omxEtsCtW9k=/devtools?uri=ws://127.0.0.1:8181/omxEtsCtW9k=/ws\n// At this point, the terminal hangs with no output.","markups":[],"codeBlockMetadata":{"mode":2,"lang":"shell"}},{"name":"b255","type":4,"text":"","markups":[],"layout":3,"metadata":{"id":"0*4btaxCBW8Btx71RM","originalWidth":1241,"originalHeight":908,"isFeatured":true}},{"name":"e0a9","type":1,"text":"Yikes! Of all the samples collected in a period of 11.6 seconds, the isolate spent more than 90% of its CPU time executing _StringBase.+. It‚Äôs likely that this is related to our performance issues, but it might not be obvious what block of code in our grep function is the source of the slowdown. Luckily, we can further narrow down the location of the expensive calls to _StringBase.+ using user tags.","markups":[{"type":10,"start":123,"end":136},{"type":10,"start":252,"end":256},{"type":10,"start":372,"end":385},{"type":1,"start":392,"end":402}]},{"name":"aa1b","type":3,"text":"Categorizing CPU samples with User Tags","markups":[]},{"name":"2dc0","type":1,"text":"When the Dart CPU profiler interrupts a thread to collect a new sample, it records the current user tag set for the isolate. The dart:developer library provides the UserTag class that allows you to specify and set custom tags for sections of code that you‚Äôre interested in profiling.","markups":[{"type":10,"start":129,"end":143},{"type":10,"start":165,"end":172},{"type":3,"start":129,"end":143,"href":"https://api.dart.dev/stable/dart-developer/dart-developer-library.html","title":"","rel":"","anchorType":0},{"type":3,"start":165,"end":172,"href":"https://api.dart.dev/stable/dart-developer/dart-developer-library.html","title":"","rel":"","anchorType":0}]},{"name":"e3b6","type":1,"text":"To better understand where we‚Äôre spending time in our grep implementation, we can instrument the function with user tags:","markups":[{"type":10,"start":54,"end":58}]},{"name":"71be","type":8,"text":"// filename: grep.dart\nimport 'dart:developer';\nimport 'dart:io';\n\n/// Finds and prints all instances of [pattern] in the [file].\nvoid grep(File file, String pattern) {\n  final defaultTag = getCurrentTag();\n  final fileReadTag = UserTag('File Read');\n  final textMatchTag = UserTag('Text Matching');\n  final printTag = UserTag('Print Output');\n\n  // Set the 'File Read' tag as the current user tag.\n  fileReadTag.makeCurrent();\n\n  // Open the file and read its contents.\n  final lines = file.readAsLinesSync();\n\n  // Set the 'Text Matching' tag as the current user tag.\n  textMatchTag.makeCurrent();\n  String output = '';\n  int lineNum = 1;\n  // Check each line to see if it matches `pattern`.\n  for (final line in lines) {\n    final matcher = RegExp(pattern);\n    if (matcher.hasMatch(line)) {\n      final foundMessage = '$lineNum:$line';\n      output += foundMessage;\n    }\n    lineNum++;\n  }\n\n  // Set the 'Print Output' tag as the current user tag.\n  printTag.makeCurrent();\n  stdout.writeln(output);\n\n  // Reset the user tag to the tag set when grep was invoked.\n  defaultTag.makeCurrent();\n}","markups":[],"codeBlockMetadata":{"mode":2,"lang":"dart"}},{"name":"beb7","type":1,"text":"Now, let‚Äôs re-run our program and open up the CPU Profiler. To see our categorized profile, select the Group by: User Tag option from the dropdown:","markups":[{"type":1,"start":103,"end":121}]},{"name":"1ba7","type":4,"text":"","markups":[],"layout":3,"metadata":{"id":"0*zxcsj31nCh14rLYa","originalWidth":1243,"originalHeight":911}},{"name":"bf60","type":1,"text":"When we expand the Text Matching tag, we confirm that the _StringBase.+ method is called in our text-matching loop:","markups":[{"type":10,"start":58,"end":71},{"type":1,"start":19,"end":32}]},{"name":"ba45","type":4,"text":"","markups":[],"layout":3,"metadata":{"id":"0*ai9S8-Y8c_94rr6p","originalWidth":1245,"originalHeight":210}},{"name":"77d5","type":1,"text":"With this information, we should be able to take a closer look at our code and identify the issue:","markups":[]},{"name":"1fe5","type":8,"text":"  // Set the ‚ÄòText Matching‚Äô tag as the current user tag.\n  textMatchTag.makeCurrent();\n  String output = '';\n  int lineNum = 1;\n  // Check each line to see if it matches `pattern`.\n  for (final line in lines) {\n    final matcher = RegExp(pattern);\n    if (matcher.hasMatch(line)) {\n      final foundMessage = '$lineNum:$line';\n      // Ahah! This is our call to _StringBase.+!\n      output += foundMessage;\n    }\n    lineNum++;\n  }","markups":[],"codeBlockMetadata":{"mode":1,"lang":"dart"}},{"name":"f1c9","type":1,"text":"There it is! We‚Äôve made the classic mistake of appending content to a String multiple times rather than using a StringBuffer. Appending content to a String creates a new string to store the result of the _StringBase.+ method. As a result, we copy output + foundMessage into a new string each time we find a match.","markups":[{"type":10,"start":70,"end":76},{"type":10,"start":112,"end":124},{"type":10,"start":149,"end":155},{"type":10,"start":204,"end":217},{"type":10,"start":247,"end":268},{"type":3,"start":70,"end":76,"href":"https://api.dart.dev/stable/dart-core/String-class.html","title":"","rel":"noopener","anchorType":0},{"type":3,"start":112,"end":124,"href":"https://api.dart.dev/stable/dart-core/StringBuffer-class.html","title":"","rel":"noopener","anchorType":0}]},{"name":"d2e0","type":1,"text":"As output gets longer, appending data to it becomes more expensive, taking O(m*n) to perform the copies, where m is the average number of characters in a match and n is the total number of characters in the final string. If we use a StringBuffer, we don‚Äôt copy output each time we append to it, instead concatenating the matches in a single O(n) operation at the end of the function.","markups":[{"type":10,"start":75,"end":81},{"type":10,"start":111,"end":112},{"type":10,"start":164,"end":165},{"type":10,"start":233,"end":245},{"type":10,"start":261,"end":267},{"type":10,"start":341,"end":345}]},{"name":"6134","type":1,"text":"Now that our app uses StringBuffer.writeln instead of appending to a String, let‚Äôs look at our function:","markups":[{"type":10,"start":22,"end":42},{"type":10,"start":69,"end":75},{"type":3,"start":22,"end":42,"href":"https://api.dart.dev/stable/dart-core/StringBuffer/writeln.html","title":"","rel":"","anchorType":0}]},{"name":"7ee0","type":8,"text":"// filename: grep.dart\nimport ‚Äòdart:developer‚Äô;\nimport 'dart:io';\n\n/// Finds and prints all instances of [pattern] in the [file].\nvoid grep(File file, String pattern) {\n  final defaultTag = getCurrentTag();\n  final fileReadTag = UserTag(‚ÄòFile Read‚Äô);\n  final textMatchTag = UserTag(‚ÄòText Matching‚Äô);\n  final printTag = UserTag(‚ÄòPrint Output‚Äô);\n\n  // Set the ‚ÄòFile Read‚Äô tag as the current user tag.\n  fileReadTag.makeCurrent();\n\n  // Open the file and read its contents.\n  final lines = file.readAsLinesSync();\n\n  // Set the ‚ÄòText Matching‚Äô tag as the current user tag.\n  textMatchTag.makeCurrent();\n  final output = StringBuffer();\n  int lineNum = 1;\n  // Check each line to see if it matches `pattern`.\n  for (final line in lines) {\n    final matcher = RegExp(pattern);\n    if (matcher.hasMatch(line)) {\n      final foundMessage = '$lineNum:$line';\n      // Add the match to the buffer without creating a copy.\n      output.writeln(foundMessage);\n    }\n    lineNum++;\n  }\n\n  // Set the ‚ÄòPrint Output‚Äô tag as the current user tag.\n  printTag.makeCurrent();\n  // output.toString() concatenates each entry in the buffer\n  // into a new String, only performing a single allocation of\n  // size `output.length`. \n  stdout.writeln(output);\n\n  // Reset the user tag to the tag set when grep was invoked.\n  defaultTag.makeCurrent();\n}","markups":[],"codeBlockMetadata":{"mode":1,"lang":"dart"}},{"name":"2f88","type":1,"text":"Let‚Äôs run our test again to see if there‚Äôs any improvement:","markups":[]},{"name":"1d16","type":8,"text":"$ dart grep.dart hummingbird_encyclopedia.txt 'Hummingbird'\n16:‚Äò‚Äô‚ÄôHummingbirds‚Äô‚Äô‚Äô are [[bird]]s native to the‚Ä¶\n22:Hummingbirds have the highest‚Ä¶\n24:Hummingbirds split from their [[Sister taxon|sister group]]‚Ä¶\n// Output continues","markups":[],"codeBlockMetadata":{"mode":2,"lang":"shell"}},{"name":"e864","type":1,"text":"Using StringBuffer, we can find all the instances of 'Hummingbird' in about 45 seconds. That‚Äôs much better and almost the same as the Unix grep implementation! Let‚Äôs take another look at the CPU profiler to see if we can improve performance further:","markups":[{"type":10,"start":6,"end":18},{"type":10,"start":53,"end":66},{"type":10,"start":139,"end":143},{"type":1,"start":76,"end":86}]},{"name":"04c3","type":4,"text":"","markups":[],"layout":3,"metadata":{"id":"0*dL9EpPsSbaU-Bem-","originalWidth":1239,"originalHeight":915}},{"name":"15cb","type":1,"text":"A quick glance at the profile tells us that we spend most of our time printing matches and that the actual matching only takes about 200ms. We should focus on the code that falls under the 'Print Output' tag:","markups":[{"type":10,"start":189,"end":203}]},{"name":"a864","type":8,"text":"  // Set the ‚ÄòPrint Output‚Äô tag as the current user tag.\n  printTag.makeCurrent();\n  // output.toString() concatenates each entry in the buffer\n  // into a new String, only performing a single allocation of\n  // size `output.length`. \n  stdout.writeln(output);","markups":[],"codeBlockMetadata":{"mode":2,"lang":"dart"}},{"name":"775f","type":1,"text":"There doesn‚Äôt seem much we can do as we are only making a single call to stdout.writeln, a member of the core dart:io library. Looking at the CPU flame chart in the profiler, we see that this code is in the SDK and that we can make no more performance gains in our code.","markups":[{"type":10,"start":73,"end":87},{"type":10,"start":110,"end":117},{"type":3,"start":73,"end":87,"href":"https://api.dart.dev/stable/dart-io/stdout.html","title":"","rel":"noopener","anchorType":0},{"type":3,"start":110,"end":117,"href":"https://api.dart.dev/stable/dart-io/dart-io-library.html","title":"","rel":"noopener","anchorType":0},{"type":3,"start":142,"end":173,"href":"https://docs.flutter.dev/tools/devtools/cpu-profiler#flame-chart","title":"","rel":"noopener","anchorType":0}]},{"name":"5fca","type":1,"text":"With that, we‚Äôre done!","markups":[]},{"name":"b16d","type":3,"text":"Summary","markups":[]},{"name":"41d0","type":1,"text":"We‚Äôve accomplished a lot since the beginning of this article. We:","markups":[]},{"name":"c7ea","type":9,"text":"Wrote a simple grep tool in Dart.","markups":[{"type":10,"start":15,"end":19}]},{"name":"354e","type":9,"text":"Identified our program had poor performance.","markups":[]},{"name":"3032","type":9,"text":"Learned about CPU profilers and explored the Dart VM‚Äôs sampling CPU profiler.","markups":[]},{"name":"d86a","type":9,"text":"Used the Dart DevTools‚Äô CPU Profiler to identify and fix our program‚Äôs performance issues.","markups":[{"type":3,"start":24,"end":36,"href":"https://docs.flutter.dev/tools/devtools/cpu-profiler","title":"","rel":"","anchorType":0}]},{"name":"1321","type":1,"text":"Having a good understanding of performance tooling is an important skill and, as we‚Äôve shown in this article, can help you identify potentially subtle performance issues in your code. The CPU Profiler is only one of many tools shipped with Dart DevTools that can help you better understand the behavior and performance of your Dart CLI and Flutter applications.","markups":[{"type":3,"start":240,"end":253,"href":"https://docs.flutter.dev/tools/devtools/overview","title":"","rel":"","anchorType":0}]},{"name":"616a","type":1,"text":"In future articles, we‚Äôll explore other ways to use Dart DevTools to debug and optimize your apps, including:","markups":[]},{"name":"78a9","type":9,"text":"Analyzing memory usage through the Memory screen","markups":[{"type":3,"start":35,"end":41,"href":"https://docs.flutter.dev/tools/devtools/memory","title":"","rel":"","anchorType":0}]},{"name":"a966","type":9,"text":"Examining execution timelines through the Performance screen","markups":[{"type":3,"start":42,"end":53,"href":"https://docs.flutter.dev/tools/devtools/performance","title":"","rel":"","anchorType":0}]},{"name":"7f46","type":9,"text":"Inspecting HTTP traffic through the Network screen","markups":[{"type":3,"start":36,"end":43,"href":"https://docs.flutter.dev/tools/devtools/network","title":"","rel":"","anchorType":0}]},{"name":"0182","type":1,"text":"Until then, happy hacking!","markups":[]},{"name":"1b32","type":1,"text":"If you feel so inclined, follow me on GitHub to keep up with my work on Flutter and the Dart virtual machine, as well as my other pet projects.","markups":[{"type":3,"start":25,"end":44,"href":"https://github.com/bkonyi","title":"","rel":"noopener ugc nofollow","anchorType":0},{"type":2,"start":0,"end":143}]}],"sections":[{"name":"f512","startIndex":0}]},"postDisplay":{"coverless":true}},"virtuals":{"statusForCollection":"APPROVED","allowNotes":true,"previewImage":{"imageId":"0*4btaxCBW8Btx71RM","filter":"","backgroundSize":"","originalWidth":1241,"originalHeight":908,"strategy":"resample","height":0,"width":0},"wordCount":2724,"imageCount":5,"readingTime":11.112578616352202,"subtitle":"","userPostRelation":{"userId":"8b6a7f6f197d","postId":"3e94a0ec06ae","readAt":0,"readLaterAddedAt":0,"votedAt":0,"collaboratorAddedAt":0,"notesAddedAt":0,"subscribedAt":0,"lastReadSectionName":"","lastReadVersionId":"","lastReadAt":0,"lastReadParagraphName":"","lastReadPercentage":0,"viewedAt":0,"presentedCountInResponseManagement":0,"clapCount":0,"seriesUpdateNotifsOptedInAt":0,"queuedAt":0,"seriesFirstViewedAt":0,"presentedCountInStream":3,"seriesLastViewedAt":0,"audioProgressSec":0},"publishedInCount":1,"usersBySocialRecommends":[],"noIndex":false,"recommends":24,"isBookmarked":false,"tags":[{"slug":"dart","name":"Dart","postCount":13858,"metadata":{"postCount":13858,"coverImage":{"id":"1*rQugDrmwFFsEDL_CqSBJNw.png","originalWidth":1536,"originalHeight":1024,"isFeatured":true}},"type":"Tag"},{"slug":"flutter","name":"Flutter","postCount":43303,"metadata":{"postCount":43303,"coverImage":{"id":"1*8zlpgRA1agpvWp-OiFKlJw.png","originalWidth":1536,"originalHeight":1024,"isFeatured":true}},"type":"Tag"},{"slug":"dart-devtools","name":"Dart Devtools","postCount":1,"metadata":{"postCount":1,"coverImage":{"id":"0*4btaxCBW8Btx71RM","originalWidth":1241,"originalHeight":908,"isFeatured":true}},"type":"Tag"},{"slug":"flutterdevtools","name":"Flutter Devtools","postCount":1,"metadata":{"postCount":1,"coverImage":{"id":"0*4btaxCBW8Btx71RM","originalWidth":1241,"originalHeight":908,"isFeatured":true}},"type":"Tag"},{"slug":"cpu-profiling","name":"Cpu Profiling","postCount":14,"metadata":{"postCount":14,"coverImage":{"id":"1*GU8WmVAAJ1Sgd0sJWGFB6A.png","originalWidth":1024,"originalHeight":1024}},"type":"Tag"}],"socialRecommendsCount":0,"responsesCreatedCount":0,"links":{"entries":[{"url":"https://en.wikipedia.org/wiki/Signal_(IPC)#Risks","alts":[],"httpStatus":200},{"url":"https://en.wikipedia.org/wiki/Circular_buffer","alts":[],"httpStatus":200},{"url":"https://en.wikipedia.org/wiki/Signal_(IPC)","alts":[],"httpStatus":200},{"url":"https://en.wikipedia.org/wiki/Interrupt","alts":[],"httpStatus":200},{"url":"https://docs.flutter.dev/tools/devtools/cpu-profiler#bottom-up","alts":[],"httpStatus":200},{"url":"https://docs.flutter.dev/tools/devtools/cpu-profiler","alts":[],"httpStatus":200},{"url":"https://docs.flutter.dev/tools/devtools/network","alts":[],"httpStatus":200},{"url":"https://docs.flutter.dev/tools/devtools/cpu-profiler#cpu-sampling-rate","alts":[],"httpStatus":200},{"url":"https://docs.flutter.dev/tools/devtools/cpu-profiler#method-table","alts":[],"httpStatus":200},{"url":"https://docs.flutter.dev/tools/devtools/cpu-profiler#flame-chart","alts":[],"httpStatus":200},{"url":"https://docs.flutter.dev/tools/devtools/cpu-profiler#call-tree","alts":[],"httpStatus":200},{"url":"https://docs.flutter.dev/tools/devtools/overview","alts":[],"httpStatus":200},{"url":"https://docs.flutter.dev/tools/devtools/memory","alts":[],"httpStatus":200},{"url":"https://docs.flutter.dev/tools/devtools/performance","alts":[],"httpStatus":200},{"url":"https://www.gnu.org/software/libc/manual/html_node/Alarm-Signals.html","alts":[],"httpStatus":200},{"url":"https://api.dart.dev/stable/dart-core/StringBuffer/writeln.html","alts":[],"httpStatus":200},{"url":"https://api.dart.dev/stable/dart-developer/dart-developer-library.html","alts":[],"httpStatus":200},{"url":"https://api.dart.dev/stable/dart-core/String-class.html","alts":[],"httpStatus":200},{"url":"https://api.dart.dev/stable/dart-developer/UserTag/UserTag.html","alts":[],"httpStatus":200},{"url":"https://api.dart.dev/stable/dart-io/dart-io-library.html","alts":[],"httpStatus":200},{"url":"https://github.com/dart-lang/sdk/blob/main/runtime/vm/service/service.md#cpusamples","alts":[],"httpStatus":200},{"url":"https://github.com/dart-lang/sdk/blob/main/runtime/vm/service/service.md#getcpusamples","alts":[],"httpStatus":200},{"url":"https://github.com/dart-lang/sdk/blob/main/runtime/vm/thread_interrupter.cc","alts":[],"httpStatus":200},{"url":"https://api.dart.dev/stable/dart-core/StringBuffer-class.html","alts":[],"httpStatus":200},{"url":"https://github.com/dart-lang/sdk/blob/bbacf39e9c1085650b5f2a180285792ad0dd76d9/runtime/vm/profiler.h#L195","alts":[],"httpStatus":200},{"url":"https://api.dart.dev/stable/dart-io/stdout.html","alts":[],"httpStatus":200},{"url":"https://github.com/dart-lang/sdk/blob/bbacf39e9c1085650b5f2a180285792ad0dd76d9/runtime/vm/profiler.cc#L208","alts":[],"httpStatus":200},{"url":"https://github.com/dart-lang/sdk/blob/bbacf39e9c1085650b5f2a180285792ad0dd76d9/runtime/vm/profiler.cc#L1311","alts":[],"httpStatus":200},{"url":"https://github.com/bkonyi","alts":[],"httpStatus":200}],"version":"0.3","generatedAt":1686667449604},"isLockedPreviewOnly":false,"metaDescription":"","totalClapCount":268,"sectionCount":1,"readingList":0,"topics":[{"topicId":"decb52b64abf","slug":"programming","createdAt":1493934116328,"deletedAt":0,"image":{"id":"1*iPa136b1cGEO7lvoXg6uHQ@2x.jpeg","originalWidth":6016,"originalHeight":4016},"name":"Programming","description":"The good, the bad, the buggy.","relatedTopics":[],"visibility":1,"relatedTags":[],"relatedTopicIds":[],"seoTitle":"Programming News and Articles‚Ää‚Äî‚ÄäMedium","type":"Topic"}]},"coverless":true,"slug":"dart-devtools-analyzing-application-performance-with-the-cpu-profiler","translationSourcePostId":"","translationSourceCreatorId":"","isApprovedTranslation":false,"inResponseToPostId":"","inResponseToRemovedAt":0,"isTitleSynthesized":false,"allowResponses":true,"importedUrl":"","importedPublishedAt":0,"visibility":0,"uniqueSlug":"dart-devtools-analyzing-application-performance-with-the-cpu-profiler-3e94a0ec06ae","previewContent":{"bodyModel":{"paragraphs":[{"name":"previewImage","type":4,"text":"","layout":10,"metadata":{"id":"0*4btaxCBW8Btx71RM","originalWidth":1241,"originalHeight":908,"isFeatured":true}},{"name":"5f04","type":3,"text":"Dart DevTools: Analyzing application performance with the CPU Profiler","markups":[],"alignment":1}],"sections":[{"startIndex":0}]},"isFullContent":false,"subtitle":""},"license":0,"inResponseToMediaResourceId":"","canonicalUrl":"https://blog.dart.dev/dart-devtools-analyzing-application-performance-with-the-cpu-profiler-3e94a0ec06ae","approvedHomeCollectionId":"23738d481ce8","isNewsletter":false,"newsletterId":"9013ad3f77be","webCanonicalUrl":"https://blog.dart.dev/dart-devtools-analyzing-application-performance-with-the-cpu-profiler-3e94a0ec06ae","mediumUrl":"https://blog.dart.dev/dart-devtools-analyzing-application-performance-with-the-cpu-profiler-3e94a0ec06ae","migrationId":"","notifyFollowers":true,"notifyTwitter":false,"notifyFacebook":false,"responseHiddenOnParentPostAt":0,"isSeries":false,"isSubscriptionLocked":false,"seriesLastAppendedAt":0,"audioVersionDurationSec":0,"sequenceId":"","isEligibleForRevenue":false,"isBlockedFromHightower":false,"deletedAt":0,"lockedPostSource":0,"hightowerMinimumGuaranteeStartsAt":0,"hightowerMinimumGuaranteeEndsAt":0,"featureLockRequestAcceptedAt":0,"mongerRequestType":1,"layerCake":0,"socialTitle":"","socialDek":"","editorialPreviewTitle":"","editorialPreviewDek":"","curationEligibleAt":0,"isProxyPost":false,"proxyPostFaviconUrl":"","proxyPostProviderName":"","proxyPostType":0,"isSuspended":false,"isLimitedState":false,"seoTitle":"","previewContent2":{"bodyModel":{"paragraphs":[{"name":"5f04","type":3,"text":"Dart DevTools: Analyzing application performance with the CPU Profiler","markups":[]},{"name":"8e25","type":1,"text":"Whether you‚Äôre a backend developer writing a command line tool using Dart, or a UX engineer building applications with Flutter, program performance is critical to the success of your project. Command line tools should minimize latency and apps should be responsive and snappy with no dropped frames. As developers, we‚Ä¶","markups":[]}],"sections":[{"name":"f512","startIndex":0}]},"isFullContent":false,"subtitle":""},"cardType":0,"isDistributionAlertDismissed":false,"isShortform":false,"shortformType":0,"responsesLocked":false,"isLockedResponse":false,"isPublishToEmail":true,"responseDistribution":0,"isMarkedPaywallOnly":false,"type":"Post"},"mentionedUsers":[],"collaborators":[],"hideMeter":false,"shareKey":"e5d12b5f7eea54081509f034ba4a0419","collectionUserRelations":[{"collectionId":"23738d481ce8","userId":"8b6a7f6f197d","role":"ADMIN"},{"collectionId":"4da7dfd21a33","userId":"8b6a7f6f197d","role":"WRITER"},{"collectionId":"24d8f4fa8912","userId":"8b6a7f6f197d","role":"WRITER"}],"mode":"canEdit","references":{"User":{"d4e32e866239":{"userId":"d4e32e866239","name":"Ben Konyi","username":"bkonyi","createdAt":1516404859563,"imageId":"1*d1hf9rmd3uJL8yb1sPMIDA.png","backgroundImageId":"","bio":"Google Senior Software Engineer ‚Äî Dart + Flutter Hacker, DevTools Expert, Amateur Cyclist, and Proud Canadian üçÅ","twitterScreenName":"","socialStats":{"userId":"d4e32e866239","usersFollowedCount":1,"usersFollowedByCount":633,"type":"SocialStats"},"social":{"userId":"8b6a7f6f197d","targetUserId":"d4e32e866239","type":"Social"},"allowNotes":1,"mediumMemberAt":0,"isWriterProgramEnrolled":true,"isSuspended":false,"isMembershipTrialEligible":true,"facebookDisplayName":"","optInToIceland":true,"hasCompletedProfile":false,"userDismissableFlags":[1,2,32,58],"hasSeenIcelandOnboarding":false,"postSubscribeMembershipUpsellShownAt":0,"languageCode":"en-ca","type":"User"}},"Collection":{"23738d481ce8":{"id":"23738d481ce8","name":"Dart","slug":"dartlang","tags":["MOBILE APP DEVELOPMENT","WEB DEVELOPMENT","DART","PROGRAMMING LANGUAGES","SOFTWARE DEVELOPMENT"],"creatorId":"a6d788faa5e5","description":"Dart is an approachable, portable, and productive language for high-quality apps on any platform. Learn more at https://dart.dev.","shortDescription":"Dart is an approachable, portable, and productive language‚Ä¶","image":{"imageId":"1*uWy1Ajpd0oTUQBO9WBHoQg@2x.png","filter":"","backgroundSize":"","originalWidth":1001,"originalHeight":1001,"strategy":"resample","height":0,"width":0},"metadata":{"followerCount":14031,"activeAt":1762974121956},"virtuals":{"permissions":{"canPublish":true,"canPublishAll":true,"canRepublish":true,"canRemove":true,"canManageAll":true,"canSubmit":true,"canEditPosts":true,"canAddWriters":true,"canViewStats":true,"canSendNewsletter":true,"canViewLockedPosts":true,"canViewCloaked":true,"canEditOwnPosts":true,"canBeAssignedAuthor":true,"canEnrollInHightower":false,"canLockPostsForMediumMembers":false,"canLockOwnPostsForMediumMembers":false,"canViewNewsletterV2Stats":true,"canCreateNewsletterV3":true},"isSubscribed":true,"isEnrolledInHightower":false,"isEligibleForHightower":false,"isSubscribedToCollectionEmails":false,"isMuted":false,"canToggleEmail":false,"isWriter":false},"logo":{"imageId":"1*NRb7RFVWJQFzY47j3v4U7Q.png","filter":"","backgroundSize":"","originalWidth":400,"originalHeight":154,"strategy":"resample","height":0,"width":0},"twitterUsername":"dart_lang","publicEmail":"medium@dartlang.org","domain":"blog.dart.dev","sections":[{"type":2,"collectionHeaderMetadata":{"title":"Dart","description":"An approachable, portable, and productive language for high-quality apps on any platform","backgroundImage":{},"logoImage":{"id":"1*knHF_qpxdtS8h0Z8EeqowA@2x.png","originalWidth":1080,"originalHeight":1080,"alt":"Dart"},"alignment":2,"layout":5}},{"type":1,"postListMetadata":{"source":1,"layout":4,"number":7,"postIds":[]}},{"type":1,"postListMetadata":{"source":1,"layout":5,"number":15,"postIds":[]}}],"tintColor":"#FF042B59","lightText":true,"favicon":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"colorPalette":{"defaultBackgroundSpectrum":{"colorPoints":[{"color":"#FF6588BA","point":0},{"color":"#FF607EAB","point":0.1},{"color":"#FF59759C","point":0.2},{"color":"#FF536B8E","point":0.3},{"color":"#FF4C617F","point":0.4},{"color":"#FF445670","point":0.5},{"color":"#FF3D4B61","point":0.6},{"color":"#FF344052","point":0.7},{"color":"#FF2B3442","point":0.8},{"color":"#FF212832","point":0.9},{"color":"#FF161A22","point":1}],"backgroundColor":"#FFFFFFFF"},"tintBackgroundSpectrum":{"colorPoints":[{"color":"#FF042B59","point":0},{"color":"#FF294871","point":0.1},{"color":"#FF456087","point":0.2},{"color":"#FF5F779B","point":0.3},{"color":"#FF788DAD","point":0.4},{"color":"#FF8FA2BF","point":0.5},{"color":"#FFA5B6CF","point":0.6},{"color":"#FFBBC9DF","point":0.7},{"color":"#FFD1DCEE","point":0.8},{"color":"#FFE6EEFC","point":0.9},{"color":"#FFFBFFFF","point":1}],"backgroundColor":"#FF042B59"},"highlightSpectrum":{"colorPoints":[{"color":"#FFECF3FF","point":0},{"color":"#FFE9F2FF","point":0.1},{"color":"#FFE5F0FF","point":0.2},{"color":"#FFE2EFFF","point":0.3},{"color":"#FFDEEDFF","point":0.4},{"color":"#FFDBEBFF","point":0.5},{"color":"#FFD7EAFF","point":0.6},{"color":"#FFD3E8FF","point":0.7},{"color":"#FFCFE6FF","point":0.8},{"color":"#FFCBE5FF","point":0.9},{"color":"#FFC8E3FF","point":1}],"backgroundColor":"#FFFFFFFF"},"darkBackgroundSpectrum":{"colorPoints":[{"color":"#FF7DA0D3","point":0},{"color":"#FF89A9D8","point":0.1},{"color":"#FF94B1DC","point":0.2},{"color":"#FFA0B9E0","point":0.3},{"color":"#FFABC1E3","point":0.4},{"color":"#FFB6C9E7","point":0.5},{"color":"#FFC0D1EB","point":0.6},{"color":"#FFCBD8EF","point":0.7},{"color":"#FFD5E0F2","point":0.8},{"color":"#FFE0E7F6","point":0.9},{"color":"#FFEAEFFA","point":1}],"backgroundColor":"#FF000000"}},"navItems":[{"type":1,"title":"Announcements","tagSlug":"announcements","url":"https://blog.dart.dev/tagged/announcements","source":"tagSlug"},{"type":5,"title":"Archive","url":"https://blog.dart.dev/archive"},{"type":3,"title":"dart.dev","url":"https://dart.dev"}],"colorBehavior":2,"collectionFeatures":[25],"ampLogo":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"header":{"title":"Dart","description":"An approachable, portable, and productive language for high-quality apps on any platform","backgroundImage":{},"logoImage":{"id":"1*knHF_qpxdtS8h0Z8EeqowA@2x.png","originalWidth":1080,"originalHeight":1080,"alt":"Dart"},"alignment":2,"layout":5},"subscriberCount":14031,"tagline":"Dart is a client-optimized language for fast apps on any platform.","isOptedIntoAurora":false,"isCurationAllowedByDefault":false,"polarisCoverImage":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"ptsQualifiedAt":1616092887098,"type":"Collection"}},"Social":{"d4e32e866239":{"userId":"8b6a7f6f197d","targetUserId":"d4e32e866239","type":"Social"}},"SocialStats":{"d4e32e866239":{"userId":"d4e32e866239","usersFollowedCount":1,"usersFollowedByCount":633,"type":"SocialStats"}}}},"v":3,"b":"20260130-1005-root"}
{"success":true,"payload":{"value":{"id":"f5db9d0f4159","versionId":"dfbc201b45","creatorId":"7c51fc1918ba","homeCollectionId":"23738d481ce8","title":"Dart’s built_value for Serialization","detectedLanguage":"en","latestVersion":"dfbc201b45","latestPublishedVersion":"dfbc201b45","hasUnpublishedEdits":false,"latestRev":1531,"createdAt":1480943776303,"updatedAt":1527365210168,"acceptedAt":0,"firstPublishedAt":1481120609197,"latestPublishedAt":1487593121878,"vote":false,"experimentalCss":"","displayAuthor":"","content":{"subtitle":"Last week I introduced built_value for immutable object models. We saw how to define object models in built_value; they’re immutable, easy…","bodyModel":{"paragraphs":[{"name":"f346","type":3,"text":"Dart’s built_value for Serialization","markups":[]},{"name":"429f","type":1,"text":"Last week I introduced built_value for immutable object models. We saw how to define object models in built_value; they’re immutable, easy to work with, and, if you like that sort of thing, a lot of fun.","markups":[{"type":3,"start":23,"end":62,"href":"https://medium.com/@davidmorgan_14314/darts-built-value-for-immutable-object-models-83e2497922d4","title":"","rel":"","anchorType":0}]},{"name":"424d","type":1,"text":"This article covers the rest of the built_value package. The biggest item is that, as you may have guessed from the title, they’re also serializable.","markups":[]},{"name":"d2cc","type":1,"text":"Here’s what built_value serialization looks like to use:","markups":[]},{"name":"24bb","type":8,"text":"// Value type defined using built_value.\nabstract class Login implements Built<Login, LoginBuilder> {\n  // Add serialization support by defining this static getter.\n  static Serializer<Login> get serializer => _$loginSerializer;","markups":[]},{"name":"7017","type":8,"text":"  ...\n}","markups":[]},{"name":"dd61","type":8,"text":"// Once per app, define a top level \"Serializer\" to gather together\n// all the generated serializers.\nSerializers serializers = _$serializers;","markups":[]},{"name":"f510","type":8,"text":"// Use it!\nvar login = new Login((b) => b\n  ..username = 'johnsmith'\n  ..password = '123456');","markups":[]},{"name":"37c3","type":8,"text":"print(JSON.encode(serializers.serialize(login)));\n-->\n[\"Login\", \"username\", \"johnsmith\", \"password\", \"123456\"]","markups":[]},{"name":"6b5d","type":1,"text":"Notice the “JSON.encode”? The serializer doesn’t actually go as far as serializing to a String; rather it converts to primitives that Dart’s built-in JSON serialization knows how to handle. So if you want to, you can use something other than JSON.","markups":[]},{"name":"f7df","type":1,"text":"You probably think of serialization as something that should “just work”, but there are a few subtle trade-offs involved. Let’s dig into built_value’s serialization.","markups":[]},{"name":"48ca","type":3,"text":"Polymorphism","markups":[]},{"name":"a26f","type":1,"text":"The single most important aspect of built_value’s serialization is that it supports polymorphism. Specifically, you can have fields of abstract types, and","markups":[{"type":2,"start":135,"end":143}]},{"name":"6a4e","type":9,"text":"any serializable implementation of that abstract type can be serialized;","markups":[]},{"name":"a4a7","type":9,"text":"enough information will be written on the wire to deserialize to the correct types.","markups":[]},{"name":"6eab","type":1,"text":"The simplest example is that it can serialize a list of Object:","markups":[]},{"name":"66a6","type":8,"text":"serializers.serialize(new BuiltList<Object>([1, 'two', 3]));\n-->\n['list', ['int', 1, 'string', 'two', 'int', 3]]","markups":[]},{"name":"d3ee","type":1,"text":"Extra information is added on the wire only as required to disambiguate when deserializing. So if you have a field of type “BuiltList<int>”, it will be serialized like “[1, 2, 3]” and not like “[‘int’, 1, ‘int’, 2, ‘int’, 3]”.","markups":[]},{"name":"a9b4","type":1,"text":"The bottom line is that you can define your object model however you like, and built_value will serialize it. If you want to see this in more detail, the map serializer test explores all the possibilities.","markups":[{"type":3,"start":154,"end":173,"href":"https://github.com/google/built_value.dart/blob/master/built_value/test/built_map_serializer_test.dart","title":"","rel":"","anchorType":0}]},{"name":"95c8","type":3,"text":"Multiple Implementations","markups":[]},{"name":"895c","type":1,"text":"Another problem all serialization mechanisms have to face is somehow defining the universe of serializable types. Here built_json does something a little unusual by allowing multiple implementations of one “type”.","markups":[{"type":2,"start":82,"end":90},{"type":2,"start":174,"end":198}]},{"name":"5b33","type":1,"text":"This works because types are defined on the wire by their class name only. No attempt is made to disambiguate between different classes called “Login”, for example; it’s assumed that both sender and receiver have a compatible serializer for a class called “Login” available.","markups":[{"type":2,"start":58,"end":73}]},{"name":"78dc","type":1,"text":"This adds useful flexibility. If you’re using Dart on the server and the client, for example, you have a choice for each class in the object model:","markups":[{"type":2,"start":105,"end":111}]},{"name":"c53e","type":9,"text":"You can use the same class on the client and server.","markups":[]},{"name":"9bc1","type":9,"text":"Or, you can use different classes. The implementations must have the same name and compatible fields.","markups":[]},{"name":"ffc1","type":1,"text":"For example, you could have a “Login” class for the client that deals with rendering and parsing; and a separate “Login” class for the server that deals with authentication and databases. Of course, the server-only implementation is free to use packages like “dart:io”, and the client-only implementation packages like “dart:html”.","markups":[]},{"name":"e563","type":3,"text":"Multiple Languages","markups":[]},{"name":"c579","type":1,"text":"Because built_value serialization identifies types by the class name alone, the serialized data maps well onto any object oriented language. Support for Java is planned via AutoValue.","markups":[{"type":3,"start":173,"end":182,"href":"https://github.com/google/auto/tree/master/value","title":"","rel":"","anchorType":0}]},{"name":"9fda","type":3,"text":"Multiple Versions","markups":[]},{"name":"870a","type":1,"text":"Serialized built_value data is backwards/forwards compatible in a very simple way: it relies on class names and field names. Class name changes and required field name changes are breaking.","markups":[]},{"name":"94f9","type":1,"text":"Nullable fields are more flexible: on serialization, they will only be written if non-null; on deserialization, they will default to null if not found. So, nullable fields can be added, removing or renamed and this is not a breaking change.","markups":[]},{"name":"b62e","type":1,"text":"Unrecognized fields are simply ignored.","markups":[]},{"name":"f8f6","type":3,"text":"No Mirrors","markups":[]},{"name":"6ce9","type":1,"text":"Finally, and crucial for performance, is that built_value doesn’t use mirrors in any shape or form. All analysis is done at codegen time, leaving you with minimal, performant serialization code.","markups":[]},{"name":"2a56","type":1,"text":"That was serialization with built_value. You can just sit down and write an object model and it is straight away serializable for use in RPCs or for long term storage.","markups":[]},{"name":"fd83","type":3,"text":"EnumClass","markups":[]},{"name":"1310","type":1,"text":"Finally, built_value comes with one more feature: EnumClass. Dart enums aren’t classes, but a powerful object model needs enums that behave like classes. The obvious pattern is to create a class with “static const” fields, and EnumClass makes this a little easier to do. It provides:","markups":[{"type":3,"start":72,"end":86,"href":"https://www.dartlang.org/guides/language/language-tour#enumerated-types","title":"","rel":"","anchorType":0}]},{"name":"b92d","type":9,"text":"Generated code for “values” and “valueOf”.","markups":[]},{"name":"baf3","type":9,"text":"Serialization via built_value serializers.","markups":[]},{"name":"fabf","type":9,"text":"An extra bonus for Angular or Angular2 users: the codegen can optionally produce a mixin to help you use the enum from templates.","markups":[]},{"name":"a0d1","type":1,"text":"All of these features can be seen in the example.","markups":[{"type":3,"start":41,"end":48,"href":"https://github.com/google/built_value.dart/blob/master/example/lib/enums.dart","title":"","rel":"","anchorType":0}]},{"name":"6892","type":1,"text":"That’s it for this week! Having covered the basics of built_value I’m ready to dive into the chat example in detail next week. Stay tuned!","markups":[]},{"name":"9469","type":1,"text":"Edit: next article.","markups":[{"type":3,"start":6,"end":18,"href":"https://medium.com/@davidmorgan_14314/building-a-chat-app-in-dart-815fcd0e5a31#.ncnhb2fh0","title":"","rel":"","anchorType":0}]}],"sections":[{"name":"5f8e","startIndex":0},{"name":"b9c6","startIndex":34},{"name":"cea5","startIndex":35},{"name":"8129","startIndex":41}]},"postDisplay":{"coverless":true}},"virtuals":{"statusForCollection":"APPROVED","allowNotes":true,"previewImage":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"wordCount":829,"imageCount":0,"readingTime":3.128301886792453,"subtitle":"Last week I introduced built_value for immutable object models. We saw how to define object models in built_value; they’re immutable, easy…","userPostRelation":{"userId":"8b6a7f6f197d","postId":"f5db9d0f4159","readAt":0,"readLaterAddedAt":0,"votedAt":0,"collaboratorAddedAt":0,"notesAddedAt":0,"subscribedAt":0,"lastReadSectionName":"","lastReadVersionId":"","lastReadAt":0,"lastReadParagraphName":"","lastReadPercentage":0,"viewedAt":0,"presentedCountInResponseManagement":0,"clapCount":0,"seriesUpdateNotifsOptedInAt":0,"queuedAt":0,"seriesFirstViewedAt":0,"presentedCountInStream":3,"seriesLastViewedAt":0,"audioProgressSec":0},"publishedInCount":1,"usersBySocialRecommends":[],"noIndex":false,"recommends":72,"isBookmarked":false,"tags":[{"slug":"programming","name":"Programming","postCount":400575,"metadata":{"postCount":400575,"coverImage":{"id":"0*7x-LQAg1xBmi-L1p","originalWidth":1800,"originalHeight":1169,"alt":"Screenshot of a desktop with the Cursor application open"}},"type":"Tag"},{"slug":"dart","name":"Dart","postCount":13858,"metadata":{"postCount":13858,"coverImage":{"id":"1*rQugDrmwFFsEDL_CqSBJNw.png","originalWidth":1536,"originalHeight":1024,"isFeatured":true}},"type":"Tag"},{"slug":"dartlang","name":"Dartlang","postCount":921,"metadata":{"postCount":921,"coverImage":{"id":"1*HNqQFQ2hdhAgjew1pIMqXA.png","originalWidth":2752,"originalHeight":1536,"isFeatured":true}},"type":"Tag"},{"slug":"immutability","name":"Immutability","postCount":647,"metadata":{"postCount":647,"coverImage":{"id":"0*7D1Dc2B_00zG3FU8","originalWidth":7360,"originalHeight":4912,"isFeatured":true,"unsplashPhotoId":"ctWw2S9VqOI"}},"type":"Tag"},{"slug":"json","name":"Json","postCount":7086,"metadata":{"postCount":7086,"coverImage":{"id":"0*Xa_ak36Qfr2AxQ5e","originalWidth":1536,"originalHeight":1024,"isFeatured":true}},"type":"Tag"}],"socialRecommendsCount":0,"responsesCreatedCount":9,"links":{"entries":[{"url":"https://medium.com/@davidmorgan_14314/darts-built-value-for-immutable-object-models-83e2497922d4","alts":[{"type":2,"url":"medium://p/83e2497922d4"},{"type":3,"url":"medium://p/83e2497922d4"}]},{"url":"https://medium.com/@davidmorgan_14314/building-a-chat-app-in-dart-815fcd0e5a31#.ncnhb2fh0","alts":[{"type":3,"url":"medium://p/815fcd0e5a31"},{"type":2,"url":"medium://p/815fcd0e5a31"}]}],"version":"0.3","generatedAt":1487593123011},"isLockedPreviewOnly":false,"metaDescription":"","totalClapCount":463,"sectionCount":4,"readingList":0,"topics":[]},"coverless":true,"slug":"darts-built-value-for-serialization","translationSourcePostId":"","translationSourceCreatorId":"","isApprovedTranslation":false,"inResponseToPostId":"","inResponseToRemovedAt":0,"isTitleSynthesized":true,"allowResponses":true,"importedUrl":"","importedPublishedAt":0,"visibility":0,"uniqueSlug":"darts-built-value-for-serialization-f5db9d0f4159","previewContent":{"bodyModel":{"paragraphs":[{"name":"f346","type":3,"text":"Dart’s built_value for Serialization","markups":[],"alignment":1},{"name":"429f","type":1,"text":"Last week I introduced built_value for immutable object models. We saw how to define object models in built_value; they’re immutable, easy to work with, and, if you like that sort of thing, a lot of fun.","markups":[{"type":3,"start":23,"end":62,"href":"https://medium.com/@davidmorgan_14314/darts-built-value-for-immutable-object-models-83e2497922d4","title":"","rel":"","anchorType":0}],"alignment":1}],"sections":[{"startIndex":0}]},"isFullContent":false,"subtitle":"Last week I introduced built_value for immutable object models. We saw how to define object models in built_value; they’re immutable, easy…"},"license":0,"inResponseToMediaResourceId":"","canonicalUrl":"https://blog.dart.dev/darts-built-value-for-serialization-f5db9d0f4159","approvedHomeCollectionId":"23738d481ce8","isNewsletter":false,"newsletterId":"","webCanonicalUrl":"https://blog.dart.dev/darts-built-value-for-serialization-f5db9d0f4159","mediumUrl":"https://blog.dart.dev/darts-built-value-for-serialization-f5db9d0f4159","migrationId":"","notifyFollowers":true,"notifyTwitter":true,"notifyFacebook":false,"responseHiddenOnParentPostAt":0,"isSeries":false,"isSubscriptionLocked":false,"seriesLastAppendedAt":0,"audioVersionDurationSec":0,"sequenceId":"","isEligibleForRevenue":false,"isBlockedFromHightower":false,"deletedAt":0,"lockedPostSource":0,"hightowerMinimumGuaranteeStartsAt":0,"hightowerMinimumGuaranteeEndsAt":0,"featureLockRequestAcceptedAt":0,"mongerRequestType":1,"layerCake":0,"socialTitle":"","socialDek":"","editorialPreviewTitle":"","editorialPreviewDek":"","curationEligibleAt":0,"isProxyPost":false,"proxyPostFaviconUrl":"","proxyPostProviderName":"","proxyPostType":0,"isSuspended":false,"isLimitedState":false,"seoTitle":"","previewContent2":{"bodyModel":{"paragraphs":[{"name":"f346","type":3,"text":"Dart’s built_value for Serialization","markups":[]},{"name":"429f","type":1,"text":"Last week I introduced built_value for immutable object models. We saw how to define object models in built_value; they’re immutable, easy to work with, and, if you like that sort of thing, a lot of fun.","markups":[{"type":3,"start":23,"end":62,"href":"https://medium.com/@davidmorgan_14314/darts-built-value-for-immutable-object-models-83e2497922d4","title":"","rel":"","anchorType":0}]},{"name":"424d","type":1,"text":"This article covers the rest of the built_value package. The biggest item is that…","markups":[]}],"sections":[{"name":"5f8e","startIndex":0}]},"isFullContent":false,"subtitle":"Last week I introduced built_value for immutable object models. We saw how to define object models in built_value; they’re immutable, easy…"},"cardType":0,"isDistributionAlertDismissed":false,"isShortform":false,"shortformType":0,"responsesLocked":false,"isLockedResponse":false,"isPublishToEmail":false,"responseDistribution":0,"isMarkedPaywallOnly":false,"type":"Post"},"mentionedUsers":[],"collaborators":[],"hideMeter":false,"shareKey":"1f0565bcf9a926ccd5acd54db9e17c5f","collectionUserRelations":[{"collectionId":"23738d481ce8","userId":"8b6a7f6f197d","role":"ADMIN"},{"collectionId":"4da7dfd21a33","userId":"8b6a7f6f197d","role":"WRITER"},{"collectionId":"24d8f4fa8912","userId":"8b6a7f6f197d","role":"WRITER"}],"mode":"canEdit","references":{"User":{"7c51fc1918ba":{"userId":"7c51fc1918ba","name":"David Morgan","username":"davidmorgan_14314","createdAt":1479905471772,"imageId":"0*CyTzB0Ea4W-QND7p.","backgroundImageId":"","bio":"Software Engineer at Google; works on Dart.","twitterScreenName":"__davidmorgan__","socialStats":{"userId":"7c51fc1918ba","usersFollowedCount":68,"usersFollowedByCount":1571,"type":"SocialStats"},"social":{"userId":"8b6a7f6f197d","targetUserId":"7c51fc1918ba","type":"Social"},"allowNotes":1,"mediumMemberAt":0,"isWriterProgramEnrolled":true,"isSuspended":false,"isMembershipTrialEligible":true,"facebookDisplayName":"","optInToIceland":true,"hasCompletedProfile":false,"userDismissableFlags":[1],"hasSeenIcelandOnboarding":false,"postSubscribeMembershipUpsellShownAt":0,"languageCode":"en-us","type":"User"}},"Collection":{"23738d481ce8":{"id":"23738d481ce8","name":"Dart","slug":"dartlang","tags":["MOBILE APP DEVELOPMENT","WEB DEVELOPMENT","DART","PROGRAMMING LANGUAGES","SOFTWARE DEVELOPMENT"],"creatorId":"a6d788faa5e5","description":"Dart is an approachable, portable, and productive language for high-quality apps on any platform. Learn more at https://dart.dev.","shortDescription":"Dart is an approachable, portable, and productive language…","image":{"imageId":"1*uWy1Ajpd0oTUQBO9WBHoQg@2x.png","filter":"","backgroundSize":"","originalWidth":1001,"originalHeight":1001,"strategy":"resample","height":0,"width":0},"metadata":{"followerCount":14031,"activeAt":1762974121956},"virtuals":{"permissions":{"canPublish":true,"canPublishAll":true,"canRepublish":true,"canRemove":true,"canManageAll":true,"canSubmit":true,"canEditPosts":true,"canAddWriters":true,"canViewStats":true,"canSendNewsletter":true,"canViewLockedPosts":true,"canViewCloaked":true,"canEditOwnPosts":true,"canBeAssignedAuthor":true,"canEnrollInHightower":false,"canLockPostsForMediumMembers":false,"canLockOwnPostsForMediumMembers":false,"canViewNewsletterV2Stats":true,"canCreateNewsletterV3":true},"isSubscribed":true,"isEnrolledInHightower":false,"isEligibleForHightower":false,"isSubscribedToCollectionEmails":false,"isMuted":false,"canToggleEmail":false,"isWriter":false},"logo":{"imageId":"1*NRb7RFVWJQFzY47j3v4U7Q.png","filter":"","backgroundSize":"","originalWidth":400,"originalHeight":154,"strategy":"resample","height":0,"width":0},"twitterUsername":"dart_lang","publicEmail":"medium@dartlang.org","domain":"blog.dart.dev","sections":[{"type":2,"collectionHeaderMetadata":{"title":"Dart","description":"An approachable, portable, and productive language for high-quality apps on any platform","backgroundImage":{},"logoImage":{"id":"1*knHF_qpxdtS8h0Z8EeqowA@2x.png","originalWidth":1080,"originalHeight":1080,"alt":"Dart"},"alignment":2,"layout":5}},{"type":1,"postListMetadata":{"source":1,"layout":4,"number":7,"postIds":[]}},{"type":1,"postListMetadata":{"source":1,"layout":5,"number":15,"postIds":[]}}],"tintColor":"#FF042B59","lightText":true,"favicon":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"colorPalette":{"defaultBackgroundSpectrum":{"colorPoints":[{"color":"#FF6588BA","point":0},{"color":"#FF607EAB","point":0.1},{"color":"#FF59759C","point":0.2},{"color":"#FF536B8E","point":0.3},{"color":"#FF4C617F","point":0.4},{"color":"#FF445670","point":0.5},{"color":"#FF3D4B61","point":0.6},{"color":"#FF344052","point":0.7},{"color":"#FF2B3442","point":0.8},{"color":"#FF212832","point":0.9},{"color":"#FF161A22","point":1}],"backgroundColor":"#FFFFFFFF"},"tintBackgroundSpectrum":{"colorPoints":[{"color":"#FF042B59","point":0},{"color":"#FF294871","point":0.1},{"color":"#FF456087","point":0.2},{"color":"#FF5F779B","point":0.3},{"color":"#FF788DAD","point":0.4},{"color":"#FF8FA2BF","point":0.5},{"color":"#FFA5B6CF","point":0.6},{"color":"#FFBBC9DF","point":0.7},{"color":"#FFD1DCEE","point":0.8},{"color":"#FFE6EEFC","point":0.9},{"color":"#FFFBFFFF","point":1}],"backgroundColor":"#FF042B59"},"highlightSpectrum":{"colorPoints":[{"color":"#FFECF3FF","point":0},{"color":"#FFE9F2FF","point":0.1},{"color":"#FFE5F0FF","point":0.2},{"color":"#FFE2EFFF","point":0.3},{"color":"#FFDEEDFF","point":0.4},{"color":"#FFDBEBFF","point":0.5},{"color":"#FFD7EAFF","point":0.6},{"color":"#FFD3E8FF","point":0.7},{"color":"#FFCFE6FF","point":0.8},{"color":"#FFCBE5FF","point":0.9},{"color":"#FFC8E3FF","point":1}],"backgroundColor":"#FFFFFFFF"},"darkBackgroundSpectrum":{"colorPoints":[{"color":"#FF7DA0D3","point":0},{"color":"#FF89A9D8","point":0.1},{"color":"#FF94B1DC","point":0.2},{"color":"#FFA0B9E0","point":0.3},{"color":"#FFABC1E3","point":0.4},{"color":"#FFB6C9E7","point":0.5},{"color":"#FFC0D1EB","point":0.6},{"color":"#FFCBD8EF","point":0.7},{"color":"#FFD5E0F2","point":0.8},{"color":"#FFE0E7F6","point":0.9},{"color":"#FFEAEFFA","point":1}],"backgroundColor":"#FF000000"}},"navItems":[{"type":1,"title":"Announcements","tagSlug":"announcements","url":"https://blog.dart.dev/tagged/announcements","source":"tagSlug"},{"type":5,"title":"Archive","url":"https://blog.dart.dev/archive"},{"type":3,"title":"dart.dev","url":"https://dart.dev"}],"colorBehavior":2,"collectionFeatures":[25],"ampLogo":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"header":{"title":"Dart","description":"An approachable, portable, and productive language for high-quality apps on any platform","backgroundImage":{},"logoImage":{"id":"1*knHF_qpxdtS8h0Z8EeqowA@2x.png","originalWidth":1080,"originalHeight":1080,"alt":"Dart"},"alignment":2,"layout":5},"subscriberCount":14031,"tagline":"Dart is a client-optimized language for fast apps on any platform.","isOptedIntoAurora":false,"isCurationAllowedByDefault":false,"polarisCoverImage":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"ptsQualifiedAt":1616092887098,"type":"Collection"}},"Social":{"7c51fc1918ba":{"userId":"8b6a7f6f197d","targetUserId":"7c51fc1918ba","type":"Social"}},"SocialStats":{"7c51fc1918ba":{"userId":"7c51fc1918ba","usersFollowedCount":68,"usersFollowedByCount":1571,"type":"SocialStats"}}}},"v":3,"b":"20260130-1012-root"}
{"success":true,"payload":{"value":{"id":"db662f705eff","versionId":"d074b8df255e","creatorId":"7c51fc1918ba","homeCollectionId":"23738d481ce8","title":"Dart’s built_collection for Immutable Collections","detectedLanguage":"en","latestVersion":"d074b8df255e","latestPublishedVersion":"d074b8df255e","hasUnpublishedEdits":false,"latestRev":737,"createdAt":1479986728968,"updatedAt":1550493465905,"acceptedAt":0,"firstPublishedAt":1479997822117,"latestPublishedAt":1550493465905,"vote":false,"experimentalCss":"","displayAuthor":"","content":{"subtitle":"A month ago I spoke at the Dart Developer Summit about object models with source_gen (video). I mentioned some packages and techniques that…","bodyModel":{"paragraphs":[{"name":"8c4e","type":3,"text":"Dart’s built_collection for Immutable Collections","markups":[]},{"name":"225a","type":1,"text":"A month ago I spoke at the Dart Developer Summit about object models with source_gen (video). I mentioned some packages and techniques that are highly deserving of a closer look, so here I am to tell the full story.","markups":[{"type":3,"start":27,"end":48,"href":"https://events.dartlang.org/2016/summit/","title":"","rel":"","anchorType":0},{"type":3,"start":55,"end":92,"href":"https://www.youtube.com/watch?v=TMeJxWltoVo","title":"","rel":"","anchorType":0}]},{"name":"77bc","type":1,"text":"First up: built_collection.","markups":[{"type":3,"start":10,"end":26,"href":"https://github.com/google/built_collection.dart","title":"","rel":"","anchorType":0}]},{"name":"6343","type":1,"text":"The built_collection package provides SDK-like collections with immutability. Immutablity for:","markups":[]},{"name":"8ce7","type":9,"text":"Simplicity, convenience. An immutable collection can be passed around without worrying about who might modify it.","markups":[]},{"name":"5dc1","type":9,"text":"Performance. Mutability leads to expensive patterns like defensive copying and change detection.","markups":[]},{"name":"e4aa","type":1,"text":"The fact that built_collection is supposed to be convenient poses some challenges for the API. Let’s take a look. First, an immutable list:","markups":[{"type":2,"start":49,"end":59}]},{"name":"7660","type":8,"text":"var list = new BuiltList<int>([1, 2, 3]);","markups":[]},{"name":"3f1f","type":1,"text":"Now I’d like to add a value to it. Of course, it’s immutable, so I can’t; what I actually want is to create a new list with an additional value tacked onto the end.","markups":[{"type":2,"start":110,"end":113}]},{"name":"5817","type":1,"text":"There is where we encounter the builder pattern for which the package is named. You get a new list by converting to a builder, making modifications, then building:","markups":[{"type":3,"start":32,"end":47,"href":"https://en.wikipedia.org/wiki/Builder_pattern","title":"","rel":"","anchorType":0}]},{"name":"fec8","type":8,"text":"var builder = list.toBuilder();\nbuilder.add(4);\nvar newList = builder.build();","markups":[]},{"name":"bdda","type":1,"text":"Builders are usually used inline, so let’s do that:","markups":[]},{"name":"977c","type":8,"text":"var newList = (list.toBuilder()..add(4)).build()","markups":[]},{"name":"8f17","type":1,"text":"This is as far as the builder pattern usually goes, but Dart has lambdas, so we can do better:","markups":[{"type":3,"start":65,"end":72,"href":"https://www.dartlang.org/guides/language/language-tour#anonymous-functions","title":"","rel":"","anchorType":0}]},{"name":"7d80","type":8,"text":"var newList = list.rebuild((b) => b.add(4));","markups":[]},{"name":"ef95","type":1,"text":"What we find is that method cascading in Dart makes the builder pattern very powerful. You can almost always do what you want inline:","markups":[{"type":3,"start":21,"end":37,"href":"https://en.wikipedia.org/wiki/Method_cascading","title":"","rel":"","anchorType":0}]},{"name":"3ebf","type":8,"text":"var newList = list.rebuild((b) => b\n    ..add(4)\n    ..addAll([7, 6, 5])\n    ..sort()\n    ..remove(1));","markups":[]},{"name":"60c8","type":1,"text":"So, as hoped — built_collection is convenient.","markups":[]},{"name":"7514","type":1,"text":"Let’s talk about performance.","markups":[]},{"name":"3d95","type":1,"text":"The Built Collections are currently optimized for code that has an update/publish cycle. That means: collections are converted to a builder, updated, built, then published — a reference is passed — for the rest of the code to consume.","markups":[]},{"name":"169a","type":1,"text":"This fits typical use in web applications, for example Angular apps. There, a user interaction or RPC response triggers an update. The data model is rebuilt before being published for rendering.","markups":[]},{"name":"9f1a","type":1,"text":"The Built Collections are not yet optimized for very frequent rebuilds, which would require implementing on top of carefully chosen data structures. If you have a use case for this, please get in touch — it is part of the design of Built Collections that this will be possible when it’s needed.","markups":[{"type":3,"start":115,"end":147,"href":"https://en.wikipedia.org/wiki/Hash_array_mapped_trie","title":"","rel":"","anchorType":0}]},{"name":"fa01","type":1,"text":"Beyond just immutability, built_collection helps you to write good, correct code. A whole bundle of properties helps here:","markups":[]},{"name":"6c89","type":9,"text":"Built Collections must be created with explicit type parameters; there is no such thing as a BuiltList<dynamic>.","markups":[]},{"name":"886e","type":8,"text":"new BuiltList([1, 2, 3]);     // Throws an exception!\nnew BuiltList<int>([1, 2, 3]); // Better.","markups":[]},{"name":"16d1","type":9,"text":"Values must be non-null; nulls cannot be added to a Built Collection.","markups":[]},{"name":"1cd7","type":8,"text":"new BuiltList([1, 2, null]);  // Throws an exception!","markups":[]},{"name":"17ce","type":9,"text":"Built Collections are comparable and hashable. This means you can put them in maps, sets, and multimaps, creating exactly the collections to match your data.","markups":[]},{"name":"81a2","type":1,"text":"These properties are particularly suited to collections of business objects: in a shopping web application, for example, to hold the current contents of the user’s shopping cart.","markups":[{"type":2,"start":59,"end":75}]},{"name":"f142","type":1,"text":"That was a quick overview of what built_collection provides and why; more information is available on the github page. To make best use of immutable collections, though, you need immutable classes. Next up: built_value!","markups":[{"type":3,"start":106,"end":117,"href":"https://github.com/google/built_collection.dart","title":"","rel":"","anchorType":0},{"type":3,"start":207,"end":218,"href":"http://github.com/google/built_value.dart","title":"","rel":"","anchorType":0}]},{"name":"0fb5","type":1,"text":"Edit: next article.","markups":[{"type":3,"start":6,"end":18,"href":"https://medium.com/@davidmorgan_14314/darts-built-value-for-immutable-object-models-83e2497922d4#.7uhmlrcz3","title":"","rel":"","anchorType":0}]}],"sections":[{"name":"ca16","startIndex":0},{"name":"3c3d","startIndex":18},{"name":"f10e","startIndex":22},{"name":"541e","startIndex":29}]},"postDisplay":{"coverless":true}},"virtuals":{"statusForCollection":"APPROVED","allowNotes":true,"previewImage":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"wordCount":553,"imageCount":0,"readingTime":2.086792452830189,"subtitle":"A month ago I spoke at the Dart Developer Summit about object models with source_gen (video). I mentioned some packages and techniques that…","userPostRelation":{"userId":"8b6a7f6f197d","postId":"db662f705eff","readAt":0,"readLaterAddedAt":0,"votedAt":0,"collaboratorAddedAt":0,"notesAddedAt":0,"subscribedAt":0,"lastReadSectionName":"","lastReadVersionId":"","lastReadAt":0,"lastReadParagraphName":"","lastReadPercentage":0,"viewedAt":0,"presentedCountInResponseManagement":0,"clapCount":0,"seriesUpdateNotifsOptedInAt":0,"queuedAt":0,"seriesFirstViewedAt":0,"presentedCountInStream":8,"seriesLastViewedAt":0,"audioProgressSec":0},"publishedInCount":1,"usersBySocialRecommends":[],"noIndex":false,"recommends":92,"isBookmarked":false,"tags":[{"slug":"programming","name":"Programming","postCount":400575,"metadata":{"postCount":400575,"coverImage":{"id":"0*7x-LQAg1xBmi-L1p","originalWidth":1800,"originalHeight":1169,"alt":"Screenshot of a desktop with the Cursor application open"}},"type":"Tag"},{"slug":"dartlang","name":"Dartlang","postCount":921,"metadata":{"postCount":921,"coverImage":{"id":"1*HNqQFQ2hdhAgjew1pIMqXA.png","originalWidth":2752,"originalHeight":1536,"isFeatured":true}},"type":"Tag"},{"slug":"dart","name":"Dart","postCount":13858,"metadata":{"postCount":13858,"coverImage":{"id":"1*rQugDrmwFFsEDL_CqSBJNw.png","originalWidth":1536,"originalHeight":1024,"isFeatured":true}},"type":"Tag"},{"slug":"immutability","name":"Immutability","postCount":647,"metadata":{"postCount":647,"coverImage":{"id":"0*7D1Dc2B_00zG3FU8","originalWidth":7360,"originalHeight":4912,"isFeatured":true,"unsplashPhotoId":"ctWw2S9VqOI"}},"type":"Tag"},{"slug":"clean-code","name":"Clean Code","postCount":12886,"metadata":{"postCount":12886,"coverImage":{"id":"0*my40IgRfG5MwXH9Z","originalWidth":5616,"originalHeight":3744,"isFeatured":true,"unsplashPhotoId":"Hcfwew744z4"}},"type":"Tag"}],"socialRecommendsCount":0,"responsesCreatedCount":8,"links":{"entries":[{"url":"https://en.wikipedia.org/wiki/Hash_array_mapped_trie","alts":[],"httpStatus":200},{"url":"https://en.wikipedia.org/wiki/Method_cascading","alts":[],"httpStatus":200},{"url":"https://en.wikipedia.org/wiki/Builder_pattern","alts":[],"httpStatus":200},{"url":"http://github.com/google/built_value.dart","alts":[],"httpStatus":200},{"url":"https://events.dartlang.org/2016/summit/","alts":[],"httpStatus":200},{"url":"https://github.com/google/built_collection.dart","alts":[],"httpStatus":200},{"url":"https://www.dartlang.org/guides/language/language-tour#anonymous-functions","alts":[],"httpStatus":200},{"url":"https://www.youtube.com/watch?v=TMeJxWltoVo","alts":[{"type":2,"url":"vnd.youtube://www.youtube.com/watch?v=TMeJxWltoVo&feature=applinks"},{"type":3,"url":"vnd.youtube://www.youtube.com/watch?v=TMeJxWltoVo&feature=applinks"}],"httpStatus":200},{"url":"https://medium.com/@davidmorgan_14314/darts-built-value-for-immutable-object-models-83e2497922d4#.7uhmlrcz3","alts":[{"type":2,"url":"medium://p/83e2497922d4"},{"type":3,"url":"medium://p/83e2497922d4"}],"httpStatus":200}],"version":"0.3","generatedAt":1550493467493},"isLockedPreviewOnly":false,"metaDescription":"","totalClapCount":607,"sectionCount":4,"readingList":0,"topics":[]},"coverless":true,"slug":"darts-built-collection-for-immutable-collections","translationSourcePostId":"","translationSourceCreatorId":"","isApprovedTranslation":false,"inResponseToPostId":"","inResponseToRemovedAt":0,"isTitleSynthesized":true,"allowResponses":true,"importedUrl":"","importedPublishedAt":0,"visibility":0,"uniqueSlug":"darts-built-collection-for-immutable-collections-db662f705eff","previewContent":{"bodyModel":{"paragraphs":[{"name":"8c4e","type":3,"text":"Dart’s built_collection for Immutable Collections","markups":[],"alignment":1},{"name":"225a","type":1,"text":"A month ago I spoke at the Dart Developer Summit about object models with source_gen (video). I mentioned some packages and techniques that are highly deserving of a closer look, so here I am to tell the full story.","markups":[{"type":3,"start":27,"end":48,"href":"https://events.dartlang.org/2016/summit/","title":"","rel":"","anchorType":0},{"type":3,"start":55,"end":92,"href":"https://www.youtube.com/watch?v=TMeJxWltoVo","title":"","rel":"","anchorType":0}],"alignment":1}],"sections":[{"startIndex":0}]},"isFullContent":false,"subtitle":"A month ago I spoke at the Dart Developer Summit about object models with source_gen (video). I mentioned some packages and techniques that…"},"license":0,"inResponseToMediaResourceId":"","canonicalUrl":"https://blog.dart.dev/darts-built-collection-for-immutable-collections-db662f705eff","approvedHomeCollectionId":"23738d481ce8","isNewsletter":false,"newsletterId":"","webCanonicalUrl":"https://blog.dart.dev/darts-built-collection-for-immutable-collections-db662f705eff","mediumUrl":"https://blog.dart.dev/darts-built-collection-for-immutable-collections-db662f705eff","migrationId":"","notifyFollowers":true,"notifyTwitter":true,"notifyFacebook":false,"responseHiddenOnParentPostAt":0,"isSeries":false,"isSubscriptionLocked":false,"seriesLastAppendedAt":0,"audioVersionDurationSec":0,"sequenceId":"","isEligibleForRevenue":false,"isBlockedFromHightower":false,"deletedAt":0,"lockedPostSource":0,"hightowerMinimumGuaranteeStartsAt":0,"hightowerMinimumGuaranteeEndsAt":0,"featureLockRequestAcceptedAt":0,"mongerRequestType":1,"layerCake":0,"socialTitle":"","socialDek":"","editorialPreviewTitle":"","editorialPreviewDek":"","curationEligibleAt":0,"isProxyPost":false,"proxyPostFaviconUrl":"","proxyPostProviderName":"","proxyPostType":0,"isSuspended":false,"isLimitedState":false,"seoTitle":"","previewContent2":{"bodyModel":{"paragraphs":[{"name":"8c4e","type":3,"text":"Dart’s built_collection for Immutable Collections","markups":[]},{"name":"225a","type":1,"text":"A month ago I spoke at the Dart Developer Summit about object models with source_gen (video). I mentioned some packages and techniques that are highly deserving of a closer look, so here I am to tell the full story.","markups":[{"type":3,"start":27,"end":48,"href":"https://events.dartlang.org/2016/summit/","title":"","rel":"","anchorType":0},{"type":3,"start":55,"end":92,"href":"https://www.youtube.com/watch?v=TMeJxWltoVo","title":"","rel":"","anchorType":0}]},{"name":"77bc","type":1,"text":"First up: built_collection.","markups":[{"type":3,"start":10,"end":26,"href":"https://github.com/google/built_collection.dart","title":"","rel":"","anchorType":0}]},{"name":"6343","type":1,"text":"The built_collection package provides SDK-like collections with immutability…","markups":[]}],"sections":[{"name":"ca16","startIndex":0}]},"isFullContent":false,"subtitle":"A month ago I spoke at the Dart Developer Summit about object models with source_gen (video). I mentioned some packages and techniques that…"},"cardType":0,"isDistributionAlertDismissed":false,"isShortform":false,"shortformType":0,"responsesLocked":false,"isLockedResponse":false,"isPublishToEmail":false,"responseDistribution":0,"isMarkedPaywallOnly":false,"type":"Post"},"mentionedUsers":[],"collaborators":[],"hideMeter":false,"shareKey":"8023b474e4a64acbd3b6ec948d8a0eea","collectionUserRelations":[{"collectionId":"23738d481ce8","userId":"8b6a7f6f197d","role":"ADMIN"},{"collectionId":"4da7dfd21a33","userId":"8b6a7f6f197d","role":"WRITER"},{"collectionId":"24d8f4fa8912","userId":"8b6a7f6f197d","role":"WRITER"}],"mode":"canEdit","references":{"User":{"7c51fc1918ba":{"userId":"7c51fc1918ba","name":"David Morgan","username":"davidmorgan_14314","createdAt":1479905471772,"imageId":"0*CyTzB0Ea4W-QND7p.","backgroundImageId":"","bio":"Software Engineer at Google; works on Dart.","twitterScreenName":"__davidmorgan__","socialStats":{"userId":"7c51fc1918ba","usersFollowedCount":68,"usersFollowedByCount":1571,"type":"SocialStats"},"social":{"userId":"8b6a7f6f197d","targetUserId":"7c51fc1918ba","type":"Social"},"allowNotes":1,"mediumMemberAt":0,"isWriterProgramEnrolled":true,"isSuspended":false,"isMembershipTrialEligible":true,"facebookDisplayName":"","optInToIceland":true,"hasCompletedProfile":false,"userDismissableFlags":[1],"hasSeenIcelandOnboarding":false,"postSubscribeMembershipUpsellShownAt":0,"languageCode":"en-us","type":"User"}},"Collection":{"23738d481ce8":{"id":"23738d481ce8","name":"Dart","slug":"dartlang","tags":["MOBILE APP DEVELOPMENT","WEB DEVELOPMENT","DART","PROGRAMMING LANGUAGES","SOFTWARE DEVELOPMENT"],"creatorId":"a6d788faa5e5","description":"Dart is an approachable, portable, and productive language for high-quality apps on any platform. Learn more at https://dart.dev.","shortDescription":"Dart is an approachable, portable, and productive language…","image":{"imageId":"1*uWy1Ajpd0oTUQBO9WBHoQg@2x.png","filter":"","backgroundSize":"","originalWidth":1001,"originalHeight":1001,"strategy":"resample","height":0,"width":0},"metadata":{"followerCount":14031,"activeAt":1762974121956},"virtuals":{"permissions":{"canPublish":true,"canPublishAll":true,"canRepublish":true,"canRemove":true,"canManageAll":true,"canSubmit":true,"canEditPosts":true,"canAddWriters":true,"canViewStats":true,"canSendNewsletter":true,"canViewLockedPosts":true,"canViewCloaked":true,"canEditOwnPosts":true,"canBeAssignedAuthor":true,"canEnrollInHightower":false,"canLockPostsForMediumMembers":false,"canLockOwnPostsForMediumMembers":false,"canViewNewsletterV2Stats":true,"canCreateNewsletterV3":true},"isSubscribed":true,"isEnrolledInHightower":false,"isEligibleForHightower":false,"isSubscribedToCollectionEmails":false,"isMuted":false,"canToggleEmail":false,"isWriter":false},"logo":{"imageId":"1*NRb7RFVWJQFzY47j3v4U7Q.png","filter":"","backgroundSize":"","originalWidth":400,"originalHeight":154,"strategy":"resample","height":0,"width":0},"twitterUsername":"dart_lang","publicEmail":"medium@dartlang.org","domain":"blog.dart.dev","sections":[{"type":2,"collectionHeaderMetadata":{"title":"Dart","description":"An approachable, portable, and productive language for high-quality apps on any platform","backgroundImage":{},"logoImage":{"id":"1*knHF_qpxdtS8h0Z8EeqowA@2x.png","originalWidth":1080,"originalHeight":1080,"alt":"Dart"},"alignment":2,"layout":5}},{"type":1,"postListMetadata":{"source":1,"layout":4,"number":7,"postIds":[]}},{"type":1,"postListMetadata":{"source":1,"layout":5,"number":15,"postIds":[]}}],"tintColor":"#FF042B59","lightText":true,"favicon":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"colorPalette":{"defaultBackgroundSpectrum":{"colorPoints":[{"color":"#FF6588BA","point":0},{"color":"#FF607EAB","point":0.1},{"color":"#FF59759C","point":0.2},{"color":"#FF536B8E","point":0.3},{"color":"#FF4C617F","point":0.4},{"color":"#FF445670","point":0.5},{"color":"#FF3D4B61","point":0.6},{"color":"#FF344052","point":0.7},{"color":"#FF2B3442","point":0.8},{"color":"#FF212832","point":0.9},{"color":"#FF161A22","point":1}],"backgroundColor":"#FFFFFFFF"},"tintBackgroundSpectrum":{"colorPoints":[{"color":"#FF042B59","point":0},{"color":"#FF294871","point":0.1},{"color":"#FF456087","point":0.2},{"color":"#FF5F779B","point":0.3},{"color":"#FF788DAD","point":0.4},{"color":"#FF8FA2BF","point":0.5},{"color":"#FFA5B6CF","point":0.6},{"color":"#FFBBC9DF","point":0.7},{"color":"#FFD1DCEE","point":0.8},{"color":"#FFE6EEFC","point":0.9},{"color":"#FFFBFFFF","point":1}],"backgroundColor":"#FF042B59"},"highlightSpectrum":{"colorPoints":[{"color":"#FFECF3FF","point":0},{"color":"#FFE9F2FF","point":0.1},{"color":"#FFE5F0FF","point":0.2},{"color":"#FFE2EFFF","point":0.3},{"color":"#FFDEEDFF","point":0.4},{"color":"#FFDBEBFF","point":0.5},{"color":"#FFD7EAFF","point":0.6},{"color":"#FFD3E8FF","point":0.7},{"color":"#FFCFE6FF","point":0.8},{"color":"#FFCBE5FF","point":0.9},{"color":"#FFC8E3FF","point":1}],"backgroundColor":"#FFFFFFFF"},"darkBackgroundSpectrum":{"colorPoints":[{"color":"#FF7DA0D3","point":0},{"color":"#FF89A9D8","point":0.1},{"color":"#FF94B1DC","point":0.2},{"color":"#FFA0B9E0","point":0.3},{"color":"#FFABC1E3","point":0.4},{"color":"#FFB6C9E7","point":0.5},{"color":"#FFC0D1EB","point":0.6},{"color":"#FFCBD8EF","point":0.7},{"color":"#FFD5E0F2","point":0.8},{"color":"#FFE0E7F6","point":0.9},{"color":"#FFEAEFFA","point":1}],"backgroundColor":"#FF000000"}},"navItems":[{"type":1,"title":"Announcements","tagSlug":"announcements","url":"https://blog.dart.dev/tagged/announcements","source":"tagSlug"},{"type":5,"title":"Archive","url":"https://blog.dart.dev/archive"},{"type":3,"title":"dart.dev","url":"https://dart.dev"}],"colorBehavior":2,"collectionFeatures":[25],"ampLogo":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"header":{"title":"Dart","description":"An approachable, portable, and productive language for high-quality apps on any platform","backgroundImage":{},"logoImage":{"id":"1*knHF_qpxdtS8h0Z8EeqowA@2x.png","originalWidth":1080,"originalHeight":1080,"alt":"Dart"},"alignment":2,"layout":5},"subscriberCount":14031,"tagline":"Dart is a client-optimized language for fast apps on any platform.","isOptedIntoAurora":false,"isCurationAllowedByDefault":false,"polarisCoverImage":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"ptsQualifiedAt":1616092887098,"type":"Collection"}},"Social":{"7c51fc1918ba":{"userId":"8b6a7f6f197d","targetUserId":"7c51fc1918ba","type":"Social"}},"SocialStats":{"7c51fc1918ba":{"userId":"7c51fc1918ba","usersFollowedCount":68,"usersFollowedByCount":1571,"type":"SocialStats"}}}},"v":3,"b":"20260130-1012-root"}